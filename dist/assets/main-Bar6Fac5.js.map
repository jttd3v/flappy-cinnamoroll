{"version":3,"file":"main-Bar6Fac5.js","sources":["../../src/core/engine/EventSystem.ts","../../src/core/engine/VisibilityManager.ts","../../src/core/engine/GameLoop.ts","../../src/core/physics/PhysicsSystem.ts","../../src/core/audio/AudioManager.ts","../../src/core/storage/SQLiteManager.ts","../../src/core/ui/AnimationManager.ts","../../src/core/ui/EffectsManager.ts","../../src/core/ui/PauseOverlay.ts","../../src/GameBridge.ts","../../src/flappy-integration.ts"],"sourcesContent":["/**\r\n * EventSystem - Pub/Sub Event System\r\n * \r\n * Centralized event system for game-wide communication.\r\n * Supports typed events and automatic cleanup.\r\n * \r\n * @module core/engine/EventSystem\r\n * @version 2.0.0\r\n */\r\n\r\n/**\r\n * Game event types\r\n */\r\nexport const GameEvents = {\r\n  // Game lifecycle\r\n  GAME_INIT: 'game:init',\r\n  GAME_START: 'game:start',\r\n  GAME_PAUSE: 'game:pause',\r\n  GAME_RESUME: 'game:resume',\r\n  GAME_OVER: 'game:over',\r\n  GAME_RESTART: 'game:restart',\r\n  \r\n  // State changes\r\n  STATE_CHANGE: 'state:change',\r\n  \r\n  // Loop events\r\n  LOOP_START: 'loop:start',\r\n  LOOP_STOP: 'loop:stop',\r\n  LOOP_PAUSE: 'loop:pause',\r\n  LOOP_RESUME: 'loop:resume',\r\n  \r\n  // Visibility\r\n  VISIBILITY_HIDDEN: 'visibility:hidden',\r\n  VISIBILITY_VISIBLE: 'visibility:visible',\r\n  \r\n  // Player events\r\n  PLAYER_JUMP: 'player:jump',\r\n  PLAYER_FLAP: 'player:flap',\r\n  PLAYER_DEATH: 'player:death',\r\n  \r\n  // Scoring\r\n  SCORE_UPDATE: 'score:update',\r\n  SCORE_MILESTONE: 'score:milestone',\r\n  HIGH_SCORE: 'score:high',\r\n  \r\n  // Collision\r\n  COLLISION: 'collision',\r\n  \r\n  // Audio\r\n  AUDIO_READY: 'audio:ready',\r\n  AUDIO_MUTE: 'audio:mute',\r\n  AUDIO_UNMUTE: 'audio:unmute',\r\n  \r\n  // Enemies\r\n  GHOST_SPAWN: 'ghost:spawn',\r\n  GHOST_DESPAWN: 'ghost:despawn',\r\n  \r\n  // Speed\r\n  SPEED_UP: 'speed:up',\r\n  \r\n  // UI\r\n  UI_BUTTON_CLICK: 'ui:button:click',\r\n  MODAL_OPEN: 'ui:modal:open',\r\n  MODAL_CLOSE: 'ui:modal:close',\r\n} as const;\r\n\r\nexport type GameEventType = typeof GameEvents[keyof typeof GameEvents];\r\n\r\ntype EventCallback<T = unknown> = (data: T) => void;\r\n\r\ninterface EventEntry {\r\n  callback: EventCallback;\r\n  once: boolean;\r\n}\r\n\r\n/**\r\n * Centralized event system\r\n */\r\nclass EventSystemClass {\r\n  private listeners: Map<string, EventEntry[]> = new Map();\r\n  private eventHistory: Array<{ event: string; data: unknown; timestamp: number }> = [];\r\n  private maxHistorySize: number = 100;\r\n  private debugMode: boolean = false;\r\n\r\n  /**\r\n   * Subscribe to an event\r\n   */\r\n  on<T = unknown>(event: string, callback: EventCallback<T>): () => void {\r\n    if (!this.listeners.has(event)) {\r\n      this.listeners.set(event, []);\r\n    }\r\n\r\n    const entry: EventEntry = { callback: callback as EventCallback, once: false };\r\n    this.listeners.get(event)!.push(entry);\r\n\r\n    if (this.debugMode) {\r\n      console.log(`ðŸ“¡ EventSystem: Subscribed to \"${event}\"`);\r\n    }\r\n\r\n    // Return unsubscribe function\r\n    return () => this.off(event, callback as EventCallback);\r\n  }\r\n\r\n  /**\r\n   * Subscribe to an event (fires only once)\r\n   */\r\n  once<T = unknown>(event: string, callback: EventCallback<T>): () => void {\r\n    if (!this.listeners.has(event)) {\r\n      this.listeners.set(event, []);\r\n    }\r\n\r\n    const entry: EventEntry = { callback: callback as EventCallback, once: true };\r\n    this.listeners.get(event)!.push(entry);\r\n\r\n    return () => this.off(event, callback as EventCallback);\r\n  }\r\n\r\n  /**\r\n   * Unsubscribe from an event\r\n   */\r\n  off(event: string, callback: EventCallback): void {\r\n    const entries = this.listeners.get(event);\r\n    if (!entries) return;\r\n\r\n    const index = entries.findIndex(e => e.callback === callback);\r\n    if (index > -1) {\r\n      entries.splice(index, 1);\r\n      \r\n      if (this.debugMode) {\r\n        console.log(`ðŸ“¡ EventSystem: Unsubscribed from \"${event}\"`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Emit an event\r\n   */\r\n  emit<T = unknown>(event: string, data?: T): void {\r\n    // Record in history\r\n    this.eventHistory.push({\r\n      event,\r\n      data,\r\n      timestamp: performance.now(),\r\n    });\r\n\r\n    // Trim history if needed\r\n    if (this.eventHistory.length > this.maxHistorySize) {\r\n      this.eventHistory.shift();\r\n    }\r\n\r\n    if (this.debugMode) {\r\n      console.log(`ðŸ“¡ EventSystem: Emit \"${event}\"`, data);\r\n    }\r\n\r\n    const entries = this.listeners.get(event);\r\n    if (!entries || entries.length === 0) return;\r\n\r\n    // Create a copy to avoid issues if callbacks modify listeners\r\n    const entriesCopy = [...entries];\r\n\r\n    for (const entry of entriesCopy) {\r\n      try {\r\n        entry.callback(data);\r\n      } catch (error) {\r\n        console.error(`EventSystem: Error in \"${event}\" handler:`, error);\r\n      }\r\n\r\n      // Remove one-time listeners\r\n      if (entry.once) {\r\n        this.off(event, entry.callback);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all listeners for an event\r\n   */\r\n  removeAllListeners(event?: string): void {\r\n    if (event) {\r\n      this.listeners.delete(event);\r\n    } else {\r\n      this.listeners.clear();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get number of listeners for an event\r\n   */\r\n  listenerCount(event: string): number {\r\n    return this.listeners.get(event)?.length ?? 0;\r\n  }\r\n\r\n  /**\r\n   * Get all registered events\r\n   */\r\n  getRegisteredEvents(): string[] {\r\n    return Array.from(this.listeners.keys());\r\n  }\r\n\r\n  /**\r\n   * Get event history\r\n   */\r\n  getHistory(): ReadonlyArray<{ event: string; data: unknown; timestamp: number }> {\r\n    return this.eventHistory;\r\n  }\r\n\r\n  /**\r\n   * Clear event history\r\n   */\r\n  clearHistory(): void {\r\n    this.eventHistory = [];\r\n  }\r\n\r\n  /**\r\n   * Enable/disable debug mode\r\n   */\r\n  setDebugMode(enabled: boolean): void {\r\n    this.debugMode = enabled;\r\n    console.log(`ðŸ“¡ EventSystem: Debug mode ${enabled ? 'enabled' : 'disabled'}`);\r\n  }\r\n\r\n  /**\r\n   * Create a scoped event emitter (auto-cleanup)\r\n   */\r\n  createScope(): ScopedEventEmitter {\r\n    return new ScopedEventEmitter(this);\r\n  }\r\n}\r\n\r\n/**\r\n * Scoped event emitter - automatically cleans up subscriptions\r\n */\r\nclass ScopedEventEmitter {\r\n  private unsubscribers: Array<() => void> = [];\r\n  private parent: EventSystemClass;\r\n\r\n  constructor(parent: EventSystemClass) {\r\n    this.parent = parent;\r\n  }\r\n\r\n  on<T = unknown>(event: string, callback: EventCallback<T>): void {\r\n    const unsub = this.parent.on(event, callback);\r\n    this.unsubscribers.push(unsub);\r\n  }\r\n\r\n  once<T = unknown>(event: string, callback: EventCallback<T>): void {\r\n    const unsub = this.parent.once(event, callback);\r\n    this.unsubscribers.push(unsub);\r\n  }\r\n\r\n  emit<T = unknown>(event: string, data?: T): void {\r\n    this.parent.emit(event, data);\r\n  }\r\n\r\n  /**\r\n   * Clean up all subscriptions from this scope\r\n   */\r\n  destroy(): void {\r\n    for (const unsub of this.unsubscribers) {\r\n      unsub();\r\n    }\r\n    this.unsubscribers = [];\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const EventSystem = new EventSystemClass();\r\n\r\n// Export types\r\nexport type { EventCallback, ScopedEventEmitter };\r\n","/**\r\n * VisibilityManager - Handles document visibility state\r\n * \r\n * Detects when browser tab becomes hidden/visible and emits events.\r\n * Critical for pausing game when user switches tabs.\r\n * \r\n * @module core/engine/VisibilityManager\r\n * @version 2.0.0\r\n */\r\n\r\nimport { EventSystem, GameEvents } from './EventSystem';\r\n\r\nexport interface VisibilityState {\r\n  isVisible: boolean;\r\n  lastVisibleTime: number;\r\n  lastHiddenTime: number;\r\n  totalHiddenTime: number;\r\n}\r\n\r\n/**\r\n * Manages document visibility state and automatic pause/resume\r\n */\r\nexport class VisibilityManager {\r\n  private static instance: VisibilityManager | null = null;\r\n  \r\n  private _isVisible: boolean = true;\r\n  private _lastVisibleTime: number = 0;\r\n  private _lastHiddenTime: number = 0;\r\n  private _totalHiddenTime: number = 0;\r\n  private _autoPauseEnabled: boolean = true;\r\n  private _initialized: boolean = false;\r\n\r\n  private constructor() {\r\n    // Private constructor for singleton\r\n  }\r\n\r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): VisibilityManager {\r\n    if (!VisibilityManager.instance) {\r\n      VisibilityManager.instance = new VisibilityManager();\r\n    }\r\n    return VisibilityManager.instance;\r\n  }\r\n\r\n  /**\r\n   * Initialize visibility tracking\r\n   */\r\n  init(): void {\r\n    if (this._initialized) return;\r\n\r\n    // Set initial state\r\n    this._isVisible = !document.hidden;\r\n    this._lastVisibleTime = performance.now();\r\n\r\n    // Listen for visibility changes\r\n    document.addEventListener('visibilitychange', this.handleVisibilityChange.bind(this));\r\n\r\n    // Also listen for page hide/show (for Safari/iOS)\r\n    window.addEventListener('pagehide', () => this.handleVisibilityChange());\r\n    window.addEventListener('pageshow', () => this.handleVisibilityChange());\r\n\r\n    // Handle window blur/focus as fallback\r\n    window.addEventListener('blur', () => {\r\n      if (this._autoPauseEnabled && this._isVisible) {\r\n        // Only trigger if we haven't already detected hidden state\r\n        // This handles cases where visibilitychange doesn't fire\r\n      }\r\n    });\r\n\r\n    window.addEventListener('focus', () => {\r\n      if (this._autoPauseEnabled && !this._isVisible) {\r\n        // Re-check visibility on focus\r\n        this.handleVisibilityChange();\r\n      }\r\n    });\r\n\r\n    this._initialized = true;\r\n    console.log('ðŸ‘ï¸ VisibilityManager initialized');\r\n  }\r\n\r\n  /**\r\n   * Handle visibility state change\r\n   */\r\n  private handleVisibilityChange(): void {\r\n    const wasVisible = this._isVisible;\r\n    this._isVisible = !document.hidden;\r\n    const now = performance.now();\r\n\r\n    if (wasVisible && !this._isVisible) {\r\n      // Tab became hidden\r\n      this._lastHiddenTime = now;\r\n      \r\n      console.log('ðŸ‘ï¸ Tab hidden');\r\n      \r\n      if (this._autoPauseEnabled) {\r\n        EventSystem.emit(GameEvents.VISIBILITY_HIDDEN, {\r\n          timestamp: now,\r\n          wasPlaying: true, // Game should check its own state\r\n        });\r\n        \r\n        // Also emit pause event for games to handle\r\n        EventSystem.emit(GameEvents.GAME_PAUSE, {\r\n          reason: 'visibility',\r\n          timestamp: now,\r\n        });\r\n      }\r\n    } else if (!wasVisible && this._isVisible) {\r\n      // Tab became visible\r\n      const hiddenDuration = now - this._lastHiddenTime;\r\n      this._totalHiddenTime += hiddenDuration;\r\n      this._lastVisibleTime = now;\r\n      \r\n      console.log(`ðŸ‘ï¸ Tab visible (was hidden for ${Math.round(hiddenDuration)}ms)`);\r\n      \r\n      if (this._autoPauseEnabled) {\r\n        EventSystem.emit(GameEvents.VISIBILITY_VISIBLE, {\r\n          timestamp: now,\r\n          hiddenDuration,\r\n        });\r\n        \r\n        // Emit resume event - games can decide whether to auto-resume\r\n        EventSystem.emit(GameEvents.GAME_RESUME, {\r\n          reason: 'visibility',\r\n          timestamp: now,\r\n          hiddenDuration,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if document is currently visible\r\n   */\r\n  get isVisible(): boolean {\r\n    return this._isVisible;\r\n  }\r\n\r\n  /**\r\n   * Get current visibility state\r\n   */\r\n  getState(): VisibilityState {\r\n    return {\r\n      isVisible: this._isVisible,\r\n      lastVisibleTime: this._lastVisibleTime,\r\n      lastHiddenTime: this._lastHiddenTime,\r\n      totalHiddenTime: this._totalHiddenTime,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Enable/disable automatic pause on tab switch\r\n   */\r\n  setAutoPause(enabled: boolean): void {\r\n    this._autoPauseEnabled = enabled;\r\n    console.log(`ðŸ‘ï¸ Auto-pause ${enabled ? 'enabled' : 'disabled'}`);\r\n  }\r\n\r\n  /**\r\n   * Check if auto-pause is enabled\r\n   */\r\n  get autoPauseEnabled(): boolean {\r\n    return this._autoPauseEnabled;\r\n  }\r\n\r\n  /**\r\n   * Clean up event listeners\r\n   */\r\n  destroy(): void {\r\n    document.removeEventListener('visibilitychange', this.handleVisibilityChange);\r\n    this._initialized = false;\r\n    VisibilityManager.instance = null;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const visibilityManager = VisibilityManager.getInstance();\r\n","/**\r\n * GameLoop - Frame-rate Independent Game Loop\r\n * \r\n * Provides a robust game loop with:\r\n * - Delta time for frame-rate independence\r\n * - Automatic pause on tab switch\r\n * - FPS tracking and limiting\r\n * - Graceful handling of long pauses\r\n * \r\n * @module core/engine/GameLoop\r\n * @version 2.0.0\r\n */\r\n\r\nimport { EventSystem, GameEvents } from './EventSystem';\r\nimport { VisibilityManager } from './VisibilityManager';\r\n\r\nexport interface GameLoopConfig {\r\n  /** Target FPS (0 = unlimited/vsync) */\r\n  targetFPS?: number;\r\n  /** Maximum delta time in ms (prevents huge jumps after pause) */\r\n  maxDeltaTime?: number;\r\n  /** Fixed timestep for physics (ms) */\r\n  fixedTimestep?: number;\r\n  /** Enable automatic pause on tab hidden */\r\n  autoPauseOnHidden?: boolean;\r\n}\r\n\r\nexport interface FrameInfo {\r\n  /** Time since last frame in milliseconds */\r\n  deltaTime: number;\r\n  /** Normalized delta (1.0 = 60fps baseline) */\r\n  deltaNormalized: number;\r\n  /** Current timestamp */\r\n  timestamp: number;\r\n  /** Current FPS */\r\n  fps: number;\r\n  /** Total elapsed time since start */\r\n  elapsedTime: number;\r\n  /** Frame count since start */\r\n  frameCount: number;\r\n}\r\n\r\nexport type UpdateCallback = (frameInfo: FrameInfo) => void;\r\nexport type RenderCallback = (frameInfo: FrameInfo) => void;\r\n\r\n/**\r\n * High-performance game loop with frame-rate independence\r\n */\r\nexport class GameLoop {\r\n  private config: Required<GameLoopConfig>;\r\n  private rafId: number | null = null;\r\n  private lastTimestamp: number = 0;\r\n  private elapsedTime: number = 0;\r\n  private frameCount: number = 0;\r\n  private isRunning: boolean = false;\r\n  private isPaused: boolean = false;\r\n  \r\n  // FPS tracking\r\n  private fpsHistory: number[] = [];\r\n  private fpsUpdateInterval: number = 500; // Update FPS every 500ms\r\n  private lastFpsUpdate: number = 0;\r\n  private currentFps: number = 60;\r\n  \r\n  // Fixed timestep accumulator (for physics)\r\n  private accumulator: number = 0;\r\n  \r\n  // Callbacks\r\n  private updateCallbacks: UpdateCallback[] = [];\r\n  private renderCallbacks: RenderCallback[] = [];\r\n  private fixedUpdateCallbacks: UpdateCallback[] = [];\r\n  \r\n  // Visibility manager\r\n  private visibilityManager: VisibilityManager;\r\n\r\n  constructor(config: GameLoopConfig = {}) {\r\n    this.config = {\r\n      targetFPS: config.targetFPS ?? 0,\r\n      maxDeltaTime: config.maxDeltaTime ?? 100, // Max 100ms delta (10 FPS minimum)\r\n      fixedTimestep: config.fixedTimestep ?? 16.67, // 60 FPS fixed step\r\n      autoPauseOnHidden: config.autoPauseOnHidden ?? true,\r\n    };\r\n\r\n    this.visibilityManager = VisibilityManager.getInstance();\r\n    \r\n    // Bind methods\r\n    this.tick = this.tick.bind(this);\r\n    \r\n    // Setup visibility handling\r\n    this.setupVisibilityHandling();\r\n  }\r\n\r\n  /**\r\n   * Setup automatic pause/resume on visibility change\r\n   */\r\n  private setupVisibilityHandling(): void {\r\n    if (!this.config.autoPauseOnHidden) return;\r\n\r\n    EventSystem.on(GameEvents.VISIBILITY_HIDDEN, () => {\r\n      if (this.isRunning && !this.isPaused) {\r\n        this.pause();\r\n        console.log('ðŸŽ® GameLoop auto-paused (tab hidden)');\r\n      }\r\n    });\r\n\r\n    EventSystem.on(GameEvents.VISIBILITY_VISIBLE, (data: { hiddenDuration: number }) => {\r\n      // Don't auto-resume - let the game decide\r\n      // But we do need to reset timing to prevent huge delta spikes\r\n      if (this.isPaused) {\r\n        this.lastTimestamp = performance.now();\r\n        this.accumulator = 0;\r\n        console.log(`ðŸŽ® GameLoop ready to resume (was hidden ${Math.round(data.hiddenDuration)}ms)`);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Main loop tick\r\n   */\r\n  private tick(timestamp: number): void {\r\n    if (!this.isRunning) return;\r\n\r\n    // Schedule next frame first (ensures consistent timing)\r\n    this.rafId = requestAnimationFrame(this.tick);\r\n\r\n    // Skip if paused\r\n    if (this.isPaused) {\r\n      this.lastTimestamp = timestamp;\r\n      return;\r\n    }\r\n\r\n    // Calculate delta time\r\n    let deltaTime = timestamp - this.lastTimestamp;\r\n    this.lastTimestamp = timestamp;\r\n\r\n    // Handle first frame\r\n    if (deltaTime === timestamp) {\r\n      deltaTime = this.config.fixedTimestep;\r\n    }\r\n\r\n    // Clamp delta time to prevent huge jumps\r\n    if (deltaTime > this.config.maxDeltaTime) {\r\n      console.warn(`âš ï¸ Large delta clamped: ${deltaTime.toFixed(1)}ms -> ${this.config.maxDeltaTime}ms`);\r\n      deltaTime = this.config.maxDeltaTime;\r\n    }\r\n\r\n    // Update elapsed time and frame count\r\n    this.elapsedTime += deltaTime;\r\n    this.frameCount++;\r\n\r\n    // Update FPS\r\n    this.updateFPS(deltaTime, timestamp);\r\n\r\n    // Create frame info\r\n    const frameInfo: FrameInfo = {\r\n      deltaTime,\r\n      deltaNormalized: deltaTime / 16.67, // Normalized to 60fps\r\n      timestamp,\r\n      fps: this.currentFps,\r\n      elapsedTime: this.elapsedTime,\r\n      frameCount: this.frameCount,\r\n    };\r\n\r\n    // Fixed timestep updates (for physics)\r\n    this.accumulator += deltaTime;\r\n    while (this.accumulator >= this.config.fixedTimestep) {\r\n      const fixedFrameInfo: FrameInfo = {\r\n        ...frameInfo,\r\n        deltaTime: this.config.fixedTimestep,\r\n        deltaNormalized: 1.0,\r\n      };\r\n      \r\n      for (const callback of this.fixedUpdateCallbacks) {\r\n        callback(fixedFrameInfo);\r\n      }\r\n      \r\n      this.accumulator -= this.config.fixedTimestep;\r\n    }\r\n\r\n    // Variable timestep updates\r\n    for (const callback of this.updateCallbacks) {\r\n      callback(frameInfo);\r\n    }\r\n\r\n    // Render\r\n    for (const callback of this.renderCallbacks) {\r\n      callback(frameInfo);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update FPS tracking\r\n   */\r\n  private updateFPS(deltaTime: number, timestamp: number): void {\r\n    // Calculate instant FPS\r\n    const instantFps = 1000 / deltaTime;\r\n    this.fpsHistory.push(instantFps);\r\n\r\n    // Keep only last N samples\r\n    if (this.fpsHistory.length > 60) {\r\n      this.fpsHistory.shift();\r\n    }\r\n\r\n    // Update displayed FPS periodically\r\n    if (timestamp - this.lastFpsUpdate > this.fpsUpdateInterval) {\r\n      const avgFps = this.fpsHistory.reduce((a, b) => a + b, 0) / this.fpsHistory.length;\r\n      this.currentFps = Math.round(avgFps);\r\n      this.lastFpsUpdate = timestamp;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Start the game loop\r\n   */\r\n  start(): void {\r\n    if (this.isRunning) return;\r\n\r\n    this.isRunning = true;\r\n    this.isPaused = false;\r\n    this.lastTimestamp = performance.now();\r\n    this.accumulator = 0;\r\n\r\n    // Initialize visibility manager\r\n    this.visibilityManager.init();\r\n\r\n    // Start the loop\r\n    this.rafId = requestAnimationFrame(this.tick);\r\n\r\n    console.log('ðŸŽ® GameLoop started');\r\n    EventSystem.emit(GameEvents.LOOP_START, { timestamp: this.lastTimestamp });\r\n  }\r\n\r\n  /**\r\n   * Stop the game loop completely\r\n   */\r\n  stop(): void {\r\n    if (!this.isRunning) return;\r\n\r\n    this.isRunning = false;\r\n    this.isPaused = false;\r\n\r\n    if (this.rafId !== null) {\r\n      cancelAnimationFrame(this.rafId);\r\n      this.rafId = null;\r\n    }\r\n\r\n    console.log('ðŸŽ® GameLoop stopped');\r\n    EventSystem.emit(GameEvents.LOOP_STOP, { \r\n      elapsedTime: this.elapsedTime,\r\n      frameCount: this.frameCount,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Pause the game loop (keeps RAF running but skips updates)\r\n   */\r\n  pause(): void {\r\n    if (!this.isRunning || this.isPaused) return;\r\n\r\n    this.isPaused = true;\r\n    console.log('ðŸŽ® GameLoop paused');\r\n    EventSystem.emit(GameEvents.LOOP_PAUSE, { timestamp: performance.now() });\r\n  }\r\n\r\n  /**\r\n   * Resume the game loop\r\n   */\r\n  resume(): void {\r\n    if (!this.isRunning || !this.isPaused) return;\r\n\r\n    this.isPaused = false;\r\n    this.lastTimestamp = performance.now();\r\n    this.accumulator = 0;\r\n\r\n    console.log('ðŸŽ® GameLoop resumed');\r\n    EventSystem.emit(GameEvents.LOOP_RESUME, { timestamp: this.lastTimestamp });\r\n  }\r\n\r\n  /**\r\n   * Toggle pause state\r\n   */\r\n  togglePause(): boolean {\r\n    if (this.isPaused) {\r\n      this.resume();\r\n    } else {\r\n      this.pause();\r\n    }\r\n    return this.isPaused;\r\n  }\r\n\r\n  /**\r\n   * Register an update callback (variable timestep)\r\n   */\r\n  onUpdate(callback: UpdateCallback): () => void {\r\n    this.updateCallbacks.push(callback);\r\n    return () => {\r\n      const index = this.updateCallbacks.indexOf(callback);\r\n      if (index > -1) this.updateCallbacks.splice(index, 1);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Register a fixed update callback (fixed timestep, ideal for physics)\r\n   */\r\n  onFixedUpdate(callback: UpdateCallback): () => void {\r\n    this.fixedUpdateCallbacks.push(callback);\r\n    return () => {\r\n      const index = this.fixedUpdateCallbacks.indexOf(callback);\r\n      if (index > -1) this.fixedUpdateCallbacks.splice(index, 1);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Register a render callback\r\n   */\r\n  onRender(callback: RenderCallback): () => void {\r\n    this.renderCallbacks.push(callback);\r\n    return () => {\r\n      const index = this.renderCallbacks.indexOf(callback);\r\n      if (index > -1) this.renderCallbacks.splice(index, 1);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get current state\r\n   */\r\n  get state() {\r\n    return {\r\n      isRunning: this.isRunning,\r\n      isPaused: this.isPaused,\r\n      fps: this.currentFps,\r\n      frameCount: this.frameCount,\r\n      elapsedTime: this.elapsedTime,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clean up resources\r\n   */\r\n  destroy(): void {\r\n    this.stop();\r\n    this.updateCallbacks = [];\r\n    this.renderCallbacks = [];\r\n    this.fixedUpdateCallbacks = [];\r\n    this.fpsHistory = [];\r\n  }\r\n}\r\n\r\n// Export factory function\r\nexport function createGameLoop(config?: GameLoopConfig): GameLoop {\r\n  return new GameLoop(config);\r\n}\r\n","/**\r\n * PhysicsSystem - Frame-rate Independent Physics\r\n * \r\n * Provides physics calculations with proper delta time support:\r\n * - Gravity and velocity\r\n * - Collision detection (AABB, Circle, Circle-Rect)\r\n * - Bounds clamping\r\n * \r\n * @module core/physics/PhysicsSystem\r\n * @version 2.0.0\r\n */\r\n\r\nexport interface Vector2 {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport interface Rectangle {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport interface Circle {\r\n  x: number;\r\n  y: number;\r\n  radius: number;\r\n}\r\n\r\nexport interface PhysicsBody {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n  velocityX: number;\r\n  velocityY: number;\r\n  accelerationX?: number;\r\n  accelerationY?: number;\r\n  isStatic?: boolean;\r\n  collisionRadius?: number; // For circular collision\r\n}\r\n\r\nexport interface PhysicsConfig {\r\n  gravity: number;\r\n  maxVelocityY: number;\r\n  maxVelocityX?: number;\r\n  friction?: number;\r\n  airResistance?: number;\r\n}\r\n\r\n/**\r\n * Default physics configuration\r\n */\r\nexport const DEFAULT_PHYSICS_CONFIG: PhysicsConfig = {\r\n  gravity: 0.4,\r\n  maxVelocityY: 10,\r\n  maxVelocityX: 10,\r\n  friction: 0.98,\r\n  airResistance: 0.99,\r\n};\r\n\r\n/**\r\n * Base time step for physics (60 FPS)\r\n */\r\nconst BASE_TIMESTEP = 16.67;\r\n\r\n/**\r\n * Physics System with delta time support\r\n */\r\nexport class PhysicsSystem {\r\n  private config: Required<PhysicsConfig>;\r\n\r\n  constructor(config: Partial<PhysicsConfig> = {}) {\r\n    this.config = {\r\n      gravity: config.gravity ?? DEFAULT_PHYSICS_CONFIG.gravity,\r\n      maxVelocityY: config.maxVelocityY ?? DEFAULT_PHYSICS_CONFIG.maxVelocityY,\r\n      maxVelocityX: config.maxVelocityX ?? DEFAULT_PHYSICS_CONFIG.maxVelocityX!,\r\n      friction: config.friction ?? DEFAULT_PHYSICS_CONFIG.friction!,\r\n      airResistance: config.airResistance ?? DEFAULT_PHYSICS_CONFIG.airResistance!,\r\n    };\r\n  }\r\n\r\n  // ==========================================\r\n  // GRAVITY & VELOCITY\r\n  // ==========================================\r\n\r\n  /**\r\n   * Apply gravity to a physics body (frame-rate independent)\r\n   */\r\n  applyGravity(body: PhysicsBody, deltaTime: number): void {\r\n    if (body.isStatic) return;\r\n\r\n    const timeFactor = deltaTime / BASE_TIMESTEP;\r\n    body.velocityY += this.config.gravity * timeFactor;\r\n  }\r\n\r\n  /**\r\n   * Apply velocity to update position (frame-rate independent)\r\n   */\r\n  applyVelocity(body: PhysicsBody, deltaTime: number): void {\r\n    if (body.isStatic) return;\r\n\r\n    const timeFactor = deltaTime / BASE_TIMESTEP;\r\n\r\n    body.x += body.velocityX * timeFactor;\r\n    body.y += body.velocityY * timeFactor;\r\n  }\r\n\r\n  /**\r\n   * Clamp velocity to maximum values\r\n   */\r\n  clampVelocity(body: PhysicsBody): void {\r\n    body.velocityY = Math.max(\r\n      -this.config.maxVelocityY,\r\n      Math.min(this.config.maxVelocityY, body.velocityY)\r\n    );\r\n\r\n    body.velocityX = Math.max(\r\n      -this.config.maxVelocityX,\r\n      Math.min(this.config.maxVelocityX, body.velocityX)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Apply an impulse (instant velocity change)\r\n   */\r\n  applyImpulse(body: PhysicsBody, impulseX: number, impulseY: number): void {\r\n    if (body.isStatic) return;\r\n\r\n    body.velocityX += impulseX;\r\n    body.velocityY += impulseY;\r\n\r\n    this.clampVelocity(body);\r\n  }\r\n\r\n  /**\r\n   * Set velocity directly\r\n   */\r\n  setVelocity(body: PhysicsBody, velocityX?: number, velocityY?: number): void {\r\n    if (velocityX !== undefined) body.velocityX = velocityX;\r\n    if (velocityY !== undefined) body.velocityY = velocityY;\r\n\r\n    this.clampVelocity(body);\r\n  }\r\n\r\n  /**\r\n   * Update physics for a body (gravity + velocity + clamp)\r\n   */\r\n  update(body: PhysicsBody, deltaTime: number): void {\r\n    this.applyGravity(body, deltaTime);\r\n    this.clampVelocity(body);\r\n    this.applyVelocity(body, deltaTime);\r\n  }\r\n\r\n  // ==========================================\r\n  // COLLISION DETECTION\r\n  // ==========================================\r\n\r\n  /**\r\n   * AABB collision detection (Axis-Aligned Bounding Box)\r\n   */\r\n  static checkAABB(a: Rectangle, b: Rectangle): boolean {\r\n    return (\r\n      a.x < b.x + b.width &&\r\n      a.x + a.width > b.x &&\r\n      a.y < b.y + b.height &&\r\n      a.y + a.height > b.y\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Circle-to-circle collision detection\r\n   */\r\n  static checkCircleCollision(a: Circle, b: Circle): boolean {\r\n    const dx = a.x - b.x;\r\n    const dy = a.y - b.y;\r\n    const distance = Math.sqrt(dx * dx + dy * dy);\r\n    return distance < a.radius + b.radius;\r\n  }\r\n\r\n  /**\r\n   * Circle-to-rectangle collision detection\r\n   * Better for rounded characters vs rectangular obstacles\r\n   */\r\n  static checkCircleRectCollision(circle: Circle, rect: Rectangle): boolean {\r\n    // Find the closest point on the rectangle to the circle center\r\n    const closestX = Math.max(rect.x, Math.min(circle.x, rect.x + rect.width));\r\n    const closestY = Math.max(rect.y, Math.min(circle.y, rect.y + rect.height));\r\n\r\n    // Calculate the distance between the circle center and closest point\r\n    const distanceX = circle.x - closestX;\r\n    const distanceY = circle.y - closestY;\r\n    const distanceSquared = distanceX * distanceX + distanceY * distanceY;\r\n\r\n    return distanceSquared < circle.radius * circle.radius;\r\n  }\r\n\r\n  /**\r\n   * Get circle bounds from physics body\r\n   */\r\n  static getCircleBounds(body: PhysicsBody): Circle {\r\n    const radius = body.collisionRadius ?? Math.min(body.width, body.height) / 2;\r\n    return {\r\n      x: body.x + body.width / 2,\r\n      y: body.y + body.height / 2,\r\n      radius,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get rectangle bounds from physics body\r\n   */\r\n  static getRectBounds(body: PhysicsBody): Rectangle {\r\n    return {\r\n      x: body.x,\r\n      y: body.y,\r\n      width: body.width,\r\n      height: body.height,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Check collision between player (circle) and obstacle (rectangle)\r\n   * More forgiving collision for rounded characters\r\n   */\r\n  static checkPlayerObstacleCollision(\r\n    player: PhysicsBody,\r\n    obstacle: Rectangle,\r\n    forgivenessPercent: number = 0.7\r\n  ): boolean {\r\n    // Use a smaller hitbox for more forgiving gameplay\r\n    const circle = this.getCircleBounds(player);\r\n    circle.radius *= forgivenessPercent;\r\n\r\n    return this.checkCircleRectCollision(circle, obstacle);\r\n  }\r\n\r\n  /**\r\n   * Check collision with cloud gap obstacles (top and bottom)\r\n   */\r\n  static checkCloudGapCollision(\r\n    player: PhysicsBody,\r\n    cloudX: number,\r\n    cloudWidth: number,\r\n    gapY: number,\r\n    gapHeight: number,\r\n    canvasHeight: number,\r\n    forgivenessPercent: number = 0.7\r\n  ): boolean {\r\n    const playerCircle = this.getCircleBounds(player);\r\n    playerCircle.radius *= forgivenessPercent;\r\n\r\n    // Top cloud rectangle\r\n    const topCloud: Rectangle = {\r\n      x: cloudX,\r\n      y: 0,\r\n      width: cloudWidth,\r\n      height: gapY,\r\n    };\r\n\r\n    // Bottom cloud rectangle\r\n    const bottomCloud: Rectangle = {\r\n      x: cloudX,\r\n      y: gapY + gapHeight,\r\n      width: cloudWidth,\r\n      height: canvasHeight - (gapY + gapHeight),\r\n    };\r\n\r\n    return (\r\n      this.checkCircleRectCollision(playerCircle, topCloud) ||\r\n      this.checkCircleRectCollision(playerCircle, bottomCloud)\r\n    );\r\n  }\r\n\r\n  // ==========================================\r\n  // BOUNDS CHECKING\r\n  // ==========================================\r\n\r\n  /**\r\n   * Check if body is out of bounds\r\n   */\r\n  static isOutOfBounds(\r\n    body: PhysicsBody,\r\n    bounds: { minX?: number; maxX?: number; minY?: number; maxY?: number }\r\n  ): { top: boolean; bottom: boolean; left: boolean; right: boolean } {\r\n    return {\r\n      top: bounds.minY !== undefined && body.y < bounds.minY,\r\n      bottom: bounds.maxY !== undefined && body.y + body.height > bounds.maxY,\r\n      left: bounds.minX !== undefined && body.x < bounds.minX,\r\n      right: bounds.maxX !== undefined && body.x + body.width > bounds.maxX,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clamp body position within bounds\r\n   */\r\n  static clampToBounds(\r\n    body: PhysicsBody,\r\n    bounds: { minX?: number; maxX?: number; minY?: number; maxY?: number }\r\n  ): { hitTop: boolean; hitBottom: boolean; hitLeft: boolean; hitRight: boolean } {\r\n    const result = { hitTop: false, hitBottom: false, hitLeft: false, hitRight: false };\r\n\r\n    if (bounds.minY !== undefined && body.y < bounds.minY) {\r\n      body.y = bounds.minY;\r\n      body.velocityY = 0;\r\n      result.hitTop = true;\r\n    }\r\n\r\n    if (bounds.maxY !== undefined && body.y + body.height > bounds.maxY) {\r\n      body.y = bounds.maxY - body.height;\r\n      body.velocityY = 0;\r\n      result.hitBottom = true;\r\n    }\r\n\r\n    if (bounds.minX !== undefined && body.x < bounds.minX) {\r\n      body.x = bounds.minX;\r\n      body.velocityX = 0;\r\n      result.hitLeft = true;\r\n    }\r\n\r\n    if (bounds.maxX !== undefined && body.x + body.width > bounds.maxX) {\r\n      body.x = bounds.maxX - body.width;\r\n      body.velocityX = 0;\r\n      result.hitRight = true;\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  // ==========================================\r\n  // UTILITY METHODS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Calculate distance between two points\r\n   */\r\n  static distance(a: Vector2, b: Vector2): number {\r\n    const dx = b.x - a.x;\r\n    const dy = b.y - a.y;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  }\r\n\r\n  /**\r\n   * Linear interpolation\r\n   */\r\n  static lerp(start: number, end: number, t: number): number {\r\n    return start + (end - start) * t;\r\n  }\r\n\r\n  /**\r\n   * Get center of a physics body\r\n   */\r\n  static getCenter(body: PhysicsBody): Vector2 {\r\n    return {\r\n      x: body.x + body.width / 2,\r\n      y: body.y + body.height / 2,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update configuration\r\n   */\r\n  setConfig(config: Partial<PhysicsConfig>): void {\r\n    Object.assign(this.config, config);\r\n  }\r\n\r\n  /**\r\n   * Get current configuration\r\n   */\r\n  getConfig(): PhysicsConfig {\r\n    return { ...this.config };\r\n  }\r\n}\r\n\r\n// Export factory function\r\nexport function createPhysicsSystem(config?: Partial<PhysicsConfig>): PhysicsSystem {\r\n  return new PhysicsSystem(config);\r\n}\r\n","/**\r\n * AudioManager - Cross-browser Audio System\r\n * \r\n * Provides reliable audio playback using Howler.js with:\r\n * - Automatic context resumption\r\n * - Procedural sound generation for dynamic effects\r\n * - Volume control and muting\r\n * - Sound pooling for performance\r\n * \r\n * @module core/audio/AudioManager\r\n * @version 2.0.0\r\n */\r\n\r\nimport { Howl, Howler } from 'howler';\r\nimport { EventSystem, GameEvents } from '../engine/EventSystem';\r\n\r\nexport interface SoundDefinition {\r\n  src?: string | string[];\r\n  volume?: number;\r\n  loop?: boolean;\r\n  sprite?: { [key: string]: [number, number] };\r\n  procedural?: boolean;\r\n  generator?: () => void;\r\n}\r\n\r\nexport interface AudioConfig {\r\n  masterVolume?: number;\r\n  sfxVolume?: number;\r\n  musicVolume?: number;\r\n  muted?: boolean;\r\n}\r\n\r\n/**\r\n * Sound types for procedural generation\r\n */\r\nexport const SoundType = {\r\n  FLAP: 'flap',\r\n  JUMP: 'jump',\r\n  SCORE: 'score',\r\n  COLLISION: 'collision',\r\n  GAME_OVER: 'gameOver',\r\n  POWER_UP: 'powerUp',\r\n  SPEED_UP: 'speedUp',\r\n  GHOST_APPEAR: 'ghostAppear',\r\n  BUTTON_CLICK: 'buttonClick',\r\n  MILESTONE: 'milestone',\r\n  CELEBRATION: 'celebration',\r\n} as const;\r\n\r\nexport type SoundTypeKey = typeof SoundType[keyof typeof SoundType];\r\n\r\n/**\r\n * Audio Manager with Howler.js and Web Audio API\r\n */\r\nexport class AudioManager {\r\n  private static instance: AudioManager | null = null;\r\n  \r\n  private sounds: Map<string, Howl> = new Map();\r\n  private audioContext: AudioContext | null = null;\r\n  private masterGain: GainNode | null = null;\r\n  \r\n  private config: Required<AudioConfig> = {\r\n    masterVolume: 1.0,\r\n    sfxVolume: 1.0,\r\n    musicVolume: 0.5,\r\n    muted: false,\r\n  };\r\n  \r\n  private initialized: boolean = false;\r\n  private contextResumed: boolean = false;\r\n  private resumeListenerAdded: boolean = false;\r\n\r\n  private constructor() {\r\n    // Private constructor for singleton\r\n  }\r\n\r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): AudioManager {\r\n    if (!AudioManager.instance) {\r\n      AudioManager.instance = new AudioManager();\r\n    }\r\n    return AudioManager.instance;\r\n  }\r\n\r\n  /**\r\n   * Initialize the audio system\r\n   */\r\n  async init(config?: AudioConfig): Promise<boolean> {\r\n    if (this.initialized) return true;\r\n\r\n    // Merge config\r\n    if (config) {\r\n      this.config = { ...this.config, ...config };\r\n    }\r\n\r\n    try {\r\n      // Initialize Howler global settings\r\n      Howler.volume(this.config.masterVolume);\r\n      Howler.mute(this.config.muted);\r\n\r\n      // Create Web Audio context for procedural sounds\r\n      this.audioContext = new (window.AudioContext || (window as any).webkitAudioContext)();\r\n      \r\n      // Create master gain\r\n      this.masterGain = this.audioContext.createGain();\r\n      this.masterGain.connect(this.audioContext.destination);\r\n      this.masterGain.gain.value = this.config.masterVolume;\r\n\r\n      // Setup context resume handler\r\n      this.setupContextResumeHandler();\r\n\r\n      this.initialized = true;\r\n      console.log('ðŸ”Š AudioManager initialized');\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.warn('ðŸ”‡ AudioManager: Web Audio API not supported', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup handler to resume audio context on user interaction\r\n   * Required by browser autoplay policies\r\n   */\r\n  private setupContextResumeHandler(): void {\r\n    if (this.resumeListenerAdded) return;\r\n\r\n    const resumeContext = async () => {\r\n      if (this.contextResumed) return;\r\n\r\n      // Resume Web Audio Context\r\n      if (this.audioContext && this.audioContext.state === 'suspended') {\r\n        try {\r\n          await this.audioContext.resume();\r\n          console.log('ðŸ”Š AudioContext resumed');\r\n        } catch (e) {\r\n          console.warn('ðŸ”‡ Failed to resume AudioContext', e);\r\n        }\r\n      }\r\n\r\n      // Resume Howler\r\n      if (Howler.ctx && Howler.ctx.state === 'suspended') {\r\n        Howler.ctx.resume();\r\n      }\r\n\r\n      this.contextResumed = true;\r\n      EventSystem.emit(GameEvents.AUDIO_READY, { timestamp: performance.now() });\r\n\r\n      // Remove listeners after successful resume\r\n      document.removeEventListener('click', resumeContext);\r\n      document.removeEventListener('touchstart', resumeContext);\r\n      document.removeEventListener('keydown', resumeContext);\r\n    };\r\n\r\n    // Add listeners for common user interactions\r\n    document.addEventListener('click', resumeContext, { once: false });\r\n    document.addEventListener('touchstart', resumeContext, { once: false });\r\n    document.addEventListener('keydown', resumeContext, { once: false });\r\n\r\n    this.resumeListenerAdded = true;\r\n  }\r\n\r\n  /**\r\n   * Ensure audio context is ready (call before playing sounds)\r\n   */\r\n  async ensureReady(): Promise<boolean> {\r\n    if (this.contextResumed) return true;\r\n\r\n    if (this.audioContext && this.audioContext.state === 'suspended') {\r\n      try {\r\n        await this.audioContext.resume();\r\n        this.contextResumed = true;\r\n        return true;\r\n      } catch {\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Load a sound from URL\r\n   */\r\n  loadSound(id: string, definition: SoundDefinition): Promise<void> {\r\n    return new Promise((resolve, reject) => {\r\n      if (!definition.src) {\r\n        reject(new Error(`No source provided for sound: ${id}`));\r\n        return;\r\n      }\r\n\r\n      const sound = new Howl({\r\n        src: Array.isArray(definition.src) ? definition.src : [definition.src],\r\n        volume: definition.volume ?? this.config.sfxVolume,\r\n        loop: definition.loop ?? false,\r\n        sprite: definition.sprite,\r\n        onload: () => {\r\n          this.sounds.set(id, sound);\r\n          console.log(`ðŸ”Š Loaded sound: ${id}`);\r\n          resolve();\r\n        },\r\n        onloaderror: (_soundId: number, error: unknown) => {\r\n          console.error(`ðŸ”‡ Failed to load sound: ${id}`, error);\r\n          reject(error);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Play a loaded sound\r\n   */\r\n  play(id: string, sprite?: string): number | undefined {\r\n    const sound = this.sounds.get(id);\r\n    if (!sound) {\r\n      // Try procedural sound\r\n      this.playProcedural(id as SoundTypeKey);\r\n      return undefined;\r\n    }\r\n\r\n    return sound.play(sprite);\r\n  }\r\n\r\n  /**\r\n   * Stop a sound\r\n   */\r\n  stop(id: string): void {\r\n    const sound = this.sounds.get(id);\r\n    sound?.stop();\r\n  }\r\n\r\n  /**\r\n   * Play a procedural sound effect\r\n   */\r\n  playProcedural(type: SoundTypeKey): void {\r\n    if (!this.audioContext || !this.masterGain) return;\r\n    if (this.config.muted) return;\r\n\r\n    const ctx = this.audioContext;\r\n    const now = ctx.currentTime;\r\n\r\n    switch (type) {\r\n      case SoundType.FLAP:\r\n        this.playFlapSound(ctx, now);\r\n        break;\r\n      case SoundType.SCORE:\r\n        this.playScoreSound(ctx, now);\r\n        break;\r\n      case SoundType.COLLISION:\r\n        this.playCollisionSound(ctx, now);\r\n        break;\r\n      case SoundType.GHOST_APPEAR:\r\n        this.playGhostSound(ctx, now);\r\n        break;\r\n      case SoundType.SPEED_UP:\r\n        this.playSpeedUpSound(ctx, now);\r\n        break;\r\n      case SoundType.BUTTON_CLICK:\r\n        this.playClickSound(ctx, now);\r\n        break;\r\n      case SoundType.MILESTONE:\r\n        this.playMilestoneSound(ctx, now);\r\n        break;\r\n      case SoundType.CELEBRATION:\r\n        this.playCelebrationSound(ctx, now);\r\n        break;\r\n      default:\r\n        console.warn(`Unknown procedural sound type: ${type}`);\r\n    }\r\n  }\r\n\r\n  // ==========================================\r\n  // PROCEDURAL SOUND GENERATORS\r\n  // ==========================================\r\n\r\n  private playFlapSound(ctx: AudioContext, now: number): void {\r\n    const osc = ctx.createOscillator();\r\n    const gain = ctx.createGain();\r\n\r\n    osc.connect(gain);\r\n    gain.connect(this.masterGain!);\r\n\r\n    osc.type = 'sine';\r\n    osc.frequency.setValueAtTime(400, now);\r\n    osc.frequency.exponentialRampToValueAtTime(600, now + 0.05);\r\n\r\n    gain.gain.setValueAtTime(0.15 * this.config.sfxVolume, now);\r\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);\r\n\r\n    osc.start(now);\r\n    osc.stop(now + 0.05);\r\n  }\r\n\r\n  private playScoreSound(ctx: AudioContext, now: number): void {\r\n    const osc = ctx.createOscillator();\r\n    const gain = ctx.createGain();\r\n\r\n    osc.connect(gain);\r\n    gain.connect(this.masterGain!);\r\n\r\n    osc.type = 'sine';\r\n    osc.frequency.setValueAtTime(523, now); // C5\r\n    osc.frequency.setValueAtTime(659, now + 0.1); // E5\r\n\r\n    gain.gain.setValueAtTime(0.3 * this.config.sfxVolume, now);\r\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\r\n\r\n    osc.start(now);\r\n    osc.stop(now + 0.2);\r\n  }\r\n\r\n  private playCollisionSound(ctx: AudioContext, now: number): void {\r\n    const osc = ctx.createOscillator();\r\n    const gain = ctx.createGain();\r\n\r\n    osc.connect(gain);\r\n    gain.connect(this.masterGain!);\r\n\r\n    osc.type = 'sawtooth';\r\n    osc.frequency.setValueAtTime(200, now);\r\n    osc.frequency.exponentialRampToValueAtTime(50, now + 0.3);\r\n\r\n    gain.gain.setValueAtTime(0.5 * this.config.sfxVolume, now);\r\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\r\n\r\n    osc.start(now);\r\n    osc.stop(now + 0.3);\r\n  }\r\n\r\n  private playGhostSound(ctx: AudioContext, now: number): void {\r\n    const osc = ctx.createOscillator();\r\n    const gain = ctx.createGain();\r\n\r\n    osc.connect(gain);\r\n    gain.connect(this.masterGain!);\r\n\r\n    osc.type = 'sawtooth';\r\n    osc.frequency.setValueAtTime(150, now);\r\n    osc.frequency.exponentialRampToValueAtTime(80, now + 0.5);\r\n\r\n    gain.gain.setValueAtTime(0.4 * this.config.sfxVolume, now);\r\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\r\n\r\n    osc.start(now);\r\n    osc.stop(now + 0.5);\r\n  }\r\n\r\n  private playSpeedUpSound(ctx: AudioContext, now: number): void {\r\n    const osc = ctx.createOscillator();\r\n    const gain = ctx.createGain();\r\n\r\n    osc.connect(gain);\r\n    gain.connect(this.masterGain!);\r\n\r\n    osc.type = 'square';\r\n    osc.frequency.setValueAtTime(300, now);\r\n    osc.frequency.exponentialRampToValueAtTime(900, now + 0.15);\r\n\r\n    gain.gain.setValueAtTime(0.2 * this.config.sfxVolume, now);\r\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\r\n\r\n    osc.start(now);\r\n    osc.stop(now + 0.15);\r\n  }\r\n\r\n  private playClickSound(ctx: AudioContext, now: number): void {\r\n    const osc = ctx.createOscillator();\r\n    const gain = ctx.createGain();\r\n\r\n    osc.connect(gain);\r\n    gain.connect(this.masterGain!);\r\n\r\n    osc.type = 'sine';\r\n    osc.frequency.setValueAtTime(800, now);\r\n\r\n    gain.gain.setValueAtTime(0.1 * this.config.sfxVolume, now);\r\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);\r\n\r\n    osc.start(now);\r\n    osc.stop(now + 0.05);\r\n  }\r\n\r\n  private playMilestoneSound(ctx: AudioContext, now: number): void {\r\n    // Arpeggio sound for milestones\r\n    const notes = [523, 659, 784, 1047]; // C5, E5, G5, C6\r\n    \r\n    notes.forEach((freq, i) => {\r\n      const osc = ctx.createOscillator();\r\n      const gain = ctx.createGain();\r\n\r\n      osc.connect(gain);\r\n      gain.connect(this.masterGain!);\r\n\r\n      osc.type = 'sine';\r\n      osc.frequency.setValueAtTime(freq, now + i * 0.1);\r\n\r\n      gain.gain.setValueAtTime(0.25 * this.config.sfxVolume, now + i * 0.1);\r\n      gain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.1 + 0.2);\r\n\r\n      osc.start(now + i * 0.1);\r\n      osc.stop(now + i * 0.1 + 0.2);\r\n    });\r\n  }\r\n\r\n  private playCelebrationSound(ctx: AudioContext, now: number): void {\r\n    // Victory fanfare\r\n    const notes = [523, 659, 784, 659, 784, 1047];\r\n    const durations = [0.15, 0.15, 0.15, 0.15, 0.15, 0.4];\r\n    \r\n    let time = 0;\r\n    notes.forEach((freq, i) => {\r\n      const osc = ctx.createOscillator();\r\n      const gain = ctx.createGain();\r\n\r\n      osc.connect(gain);\r\n      gain.connect(this.masterGain!);\r\n\r\n      osc.type = 'sine';\r\n      osc.frequency.setValueAtTime(freq, now + time);\r\n\r\n      gain.gain.setValueAtTime(0.3 * this.config.sfxVolume, now + time);\r\n      gain.gain.exponentialRampToValueAtTime(0.01, now + time + durations[i]);\r\n\r\n      osc.start(now + time);\r\n      osc.stop(now + time + durations[i]);\r\n      \r\n      time += durations[i];\r\n    });\r\n  }\r\n\r\n  // ==========================================\r\n  // VOLUME & MUTE CONTROLS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Set master volume\r\n   */\r\n  setMasterVolume(volume: number): void {\r\n    this.config.masterVolume = Math.max(0, Math.min(1, volume));\r\n    Howler.volume(this.config.masterVolume);\r\n    \r\n    if (this.masterGain) {\r\n      this.masterGain.gain.value = this.config.masterVolume;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set SFX volume\r\n   */\r\n  setSfxVolume(volume: number): void {\r\n    this.config.sfxVolume = Math.max(0, Math.min(1, volume));\r\n  }\r\n\r\n  /**\r\n   * Set music volume\r\n   */\r\n  setMusicVolume(volume: number): void {\r\n    this.config.musicVolume = Math.max(0, Math.min(1, volume));\r\n  }\r\n\r\n  /**\r\n   * Mute all audio\r\n   */\r\n  mute(): void {\r\n    this.config.muted = true;\r\n    Howler.mute(true);\r\n    EventSystem.emit(GameEvents.AUDIO_MUTE);\r\n  }\r\n\r\n  /**\r\n   * Unmute audio\r\n   */\r\n  unmute(): void {\r\n    this.config.muted = false;\r\n    Howler.mute(false);\r\n    EventSystem.emit(GameEvents.AUDIO_UNMUTE);\r\n  }\r\n\r\n  /**\r\n   * Toggle mute state\r\n   */\r\n  toggleMute(): boolean {\r\n    if (this.config.muted) {\r\n      this.unmute();\r\n    } else {\r\n      this.mute();\r\n    }\r\n    return this.config.muted;\r\n  }\r\n\r\n  /**\r\n   * Check if muted\r\n   */\r\n  get isMuted(): boolean {\r\n    return this.config.muted;\r\n  }\r\n\r\n  /**\r\n   * Get current config\r\n   */\r\n  getConfig(): AudioConfig {\r\n    return { ...this.config };\r\n  }\r\n\r\n  /**\r\n   * Clean up resources\r\n   */\r\n  destroy(): void {\r\n    // Stop all sounds\r\n    this.sounds.forEach(sound => sound.unload());\r\n    this.sounds.clear();\r\n\r\n    // Close audio context\r\n    if (this.audioContext) {\r\n      this.audioContext.close();\r\n      this.audioContext = null;\r\n    }\r\n\r\n    this.initialized = false;\r\n    AudioManager.instance = null;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const audioManager = AudioManager.getInstance();\r\n","/**\r\n * SQLiteManager - Browser SQLite with sql.js\r\n * \r\n * Provides SQLite database in browser using WebAssembly.\r\n * Data is persisted to IndexedDB for durability.\r\n * \r\n * @module core/storage/SQLiteManager\r\n * @version 2.0.0\r\n */\r\n\r\nimport initSqlJs, { Database, SqlJsStatic } from 'sql.js';\r\n\r\nexport interface PlayerRecord {\r\n  id: number;\r\n  name: string;\r\n  created_at: string;\r\n  last_played: string | null;\r\n}\r\n\r\nexport interface ScoreRecord {\r\n  id: number;\r\n  player_id: number;\r\n  game: string;\r\n  score: number;\r\n  level: number;\r\n  played_at: string;\r\n}\r\n\r\nexport interface AchievementRecord {\r\n  id: number;\r\n  player_id: number;\r\n  achievement_key: string;\r\n  unlocked_at: string;\r\n}\r\n\r\nconst DB_NAME = 'CinnamorollGamesDB';\r\nconst DB_STORE = 'sqlite';\r\nconst DB_VERSION = 1;\r\n\r\n/**\r\n * SQLite database manager using sql.js (WASM)\r\n */\r\nexport class SQLiteManager {\r\n  private static instance: SQLiteManager | null = null;\r\n  \r\n  private SQL: SqlJsStatic | null = null;\r\n  private db: Database | null = null;\r\n  private initialized: boolean = false;\r\n\r\n  private constructor() {\r\n    // Private constructor for singleton\r\n  }\r\n\r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): SQLiteManager {\r\n    if (!SQLiteManager.instance) {\r\n      SQLiteManager.instance = new SQLiteManager();\r\n    }\r\n    return SQLiteManager.instance;\r\n  }\r\n\r\n  /**\r\n   * Initialize the database\r\n   */\r\n  async init(): Promise<boolean> {\r\n    if (this.initialized) return true;\r\n\r\n    try {\r\n      // Initialize sql.js with WASM\r\n      this.SQL = await initSqlJs({\r\n        // Load WASM from CDN (can also be bundled locally)\r\n        locateFile: (file: string) => `https://sql.js.org/dist/${file}`,\r\n      });\r\n\r\n      // Try to load existing database from IndexedDB\r\n      const savedData = await this.loadFromIndexedDB();\r\n      \r\n      if (savedData) {\r\n        this.db = new this.SQL.Database(savedData);\r\n        console.log('ðŸ’¾ SQLite: Loaded existing database');\r\n      } else {\r\n        this.db = new this.SQL.Database();\r\n        await this.runMigrations();\r\n        console.log('ðŸ’¾ SQLite: Created new database');\r\n      }\r\n\r\n      this.initialized = true;\r\n      console.log('ðŸ’¾ SQLiteManager initialized');\r\n      \r\n      return true;\r\n    } catch (error) {\r\n      console.error('ðŸ’¾ SQLiteManager: Failed to initialize', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Run database schema migrations\r\n   */\r\n  private async runMigrations(): Promise<void> {\r\n    if (!this.db) return;\r\n\r\n    // Create tables\r\n    this.db.run(`\r\n      CREATE TABLE IF NOT EXISTS players (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        name TEXT UNIQUE NOT NULL COLLATE NOCASE,\r\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        last_played DATETIME\r\n      );\r\n    `);\r\n\r\n    this.db.run(`\r\n      CREATE TABLE IF NOT EXISTS scores (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        player_id INTEGER NOT NULL,\r\n        game TEXT NOT NULL,\r\n        score INTEGER NOT NULL,\r\n        level INTEGER DEFAULT 1,\r\n        played_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (player_id) REFERENCES players(id)\r\n      );\r\n    `);\r\n\r\n    this.db.run(`\r\n      CREATE TABLE IF NOT EXISTS achievements (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        player_id INTEGER NOT NULL,\r\n        achievement_key TEXT NOT NULL,\r\n        unlocked_at DATETIME DEFAULT CURRENT_TIMESTAMP,\r\n        FOREIGN KEY (player_id) REFERENCES players(id),\r\n        UNIQUE(player_id, achievement_key)\r\n      );\r\n    `);\r\n\r\n    this.db.run(`\r\n      CREATE TABLE IF NOT EXISTS settings (\r\n        key TEXT PRIMARY KEY,\r\n        value TEXT NOT NULL\r\n      );\r\n    `);\r\n\r\n    // Create indexes\r\n    this.db.run(`CREATE INDEX IF NOT EXISTS idx_scores_player ON scores(player_id);`);\r\n    this.db.run(`CREATE INDEX IF NOT EXISTS idx_scores_game ON scores(game);`);\r\n    this.db.run(`CREATE INDEX IF NOT EXISTS idx_scores_score ON scores(score DESC);`);\r\n    this.db.run(`CREATE INDEX IF NOT EXISTS idx_achievements_player ON achievements(player_id);`);\r\n\r\n    // Save after migrations\r\n    await this.persist();\r\n  }\r\n\r\n  // ==========================================\r\n  // PLAYER OPERATIONS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Get or create a player by name\r\n   */\r\n  getOrCreatePlayer(name: string): PlayerRecord | null {\r\n    if (!this.db) return null;\r\n\r\n    const trimmedName = name.trim();\r\n    if (!trimmedName) return null;\r\n\r\n    // Try to find existing player (case-insensitive)\r\n    const existing = this.db.exec(\r\n      `SELECT id, name, created_at, last_played FROM players WHERE name = ? COLLATE NOCASE`,\r\n      [trimmedName]\r\n    );\r\n\r\n    if (existing.length > 0 && existing[0].values.length > 0) {\r\n      const row = existing[0].values[0];\r\n      return {\r\n        id: row[0] as number,\r\n        name: row[1] as string,\r\n        created_at: row[2] as string,\r\n        last_played: row[3] as string | null,\r\n      };\r\n    }\r\n\r\n    // Create new player\r\n    this.db.run(`INSERT INTO players (name) VALUES (?)`, [trimmedName]);\r\n    \r\n    // Get the created player\r\n    const created = this.db.exec(\r\n      `SELECT id, name, created_at, last_played FROM players WHERE name = ? COLLATE NOCASE`,\r\n      [trimmedName]\r\n    );\r\n\r\n    if (created.length > 0 && created[0].values.length > 0) {\r\n      const row = created[0].values[0];\r\n      this.persist(); // Save to IndexedDB\r\n      return {\r\n        id: row[0] as number,\r\n        name: row[1] as string,\r\n        created_at: row[2] as string,\r\n        last_played: row[3] as string | null,\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Update player's last played timestamp\r\n   */\r\n  updateLastPlayed(playerId: number): void {\r\n    if (!this.db) return;\r\n    this.db.run(\r\n      `UPDATE players SET last_played = CURRENT_TIMESTAMP WHERE id = ?`,\r\n      [playerId]\r\n    );\r\n    this.persist();\r\n  }\r\n\r\n  /**\r\n   * Get all players\r\n   */\r\n  getAllPlayers(): PlayerRecord[] {\r\n    if (!this.db) return [];\r\n\r\n    const result = this.db.exec(\r\n      `SELECT id, name, created_at, last_played FROM players ORDER BY last_played DESC`\r\n    );\r\n\r\n    if (result.length === 0) return [];\r\n\r\n    return result[0].values.map(row => ({\r\n      id: row[0] as number,\r\n      name: row[1] as string,\r\n      created_at: row[2] as string,\r\n      last_played: row[3] as string | null,\r\n    }));\r\n  }\r\n\r\n  // ==========================================\r\n  // SCORE OPERATIONS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Add a new score\r\n   */\r\n  addScore(playerId: number, game: string, score: number, level: number = 1): number {\r\n    if (!this.db) return -1;\r\n\r\n    this.db.run(\r\n      `INSERT INTO scores (player_id, game, score, level) VALUES (?, ?, ?, ?)`,\r\n      [playerId, game, score, level]\r\n    );\r\n\r\n    // Get the ID of the inserted row\r\n    const result = this.db.exec(`SELECT last_insert_rowid()`);\r\n    const newId = result[0]?.values[0]?.[0] as number ?? -1;\r\n\r\n    // Update last played\r\n    this.updateLastPlayed(playerId);\r\n\r\n    return newId;\r\n  }\r\n\r\n  /**\r\n   * Get high scores for a game\r\n   */\r\n  getHighScores(game: string, limit: number = 10): Array<ScoreRecord & { player_name: string }> {\r\n    if (!this.db) return [];\r\n\r\n    const result = this.db.exec(`\r\n      SELECT s.id, s.player_id, s.game, s.score, s.level, s.played_at, p.name as player_name\r\n      FROM scores s\r\n      JOIN players p ON s.player_id = p.id\r\n      WHERE s.game = ?\r\n      ORDER BY s.score DESC\r\n      LIMIT ?\r\n    `, [game, limit]);\r\n\r\n    if (result.length === 0) return [];\r\n\r\n    return result[0].values.map(row => ({\r\n      id: row[0] as number,\r\n      player_id: row[1] as number,\r\n      game: row[2] as string,\r\n      score: row[3] as number,\r\n      level: row[4] as number,\r\n      played_at: row[5] as string,\r\n      player_name: row[6] as string,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Get player's best score for a game\r\n   */\r\n  getPlayerBestScore(playerId: number, game: string): number {\r\n    if (!this.db) return 0;\r\n\r\n    const result = this.db.exec(\r\n      `SELECT MAX(score) FROM scores WHERE player_id = ? AND game = ?`,\r\n      [playerId, game]\r\n    );\r\n\r\n    return result[0]?.values[0]?.[0] as number ?? 0;\r\n  }\r\n\r\n  /**\r\n   * Get player's score history for a game\r\n   */\r\n  getPlayerScoreHistory(playerId: number, game: string, limit: number = 20): ScoreRecord[] {\r\n    if (!this.db) return [];\r\n\r\n    const result = this.db.exec(`\r\n      SELECT id, player_id, game, score, level, played_at\r\n      FROM scores\r\n      WHERE player_id = ? AND game = ?\r\n      ORDER BY played_at DESC\r\n      LIMIT ?\r\n    `, [playerId, game, limit]);\r\n\r\n    if (result.length === 0) return [];\r\n\r\n    return result[0].values.map(row => ({\r\n      id: row[0] as number,\r\n      player_id: row[1] as number,\r\n      game: row[2] as string,\r\n      score: row[3] as number,\r\n      level: row[4] as number,\r\n      played_at: row[5] as string,\r\n    }));\r\n  }\r\n\r\n  // ==========================================\r\n  // ACHIEVEMENT OPERATIONS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Unlock an achievement\r\n   */\r\n  unlockAchievement(playerId: number, achievementKey: string): boolean {\r\n    if (!this.db) return false;\r\n\r\n    try {\r\n      this.db.run(\r\n        `INSERT OR IGNORE INTO achievements (player_id, achievement_key) VALUES (?, ?)`,\r\n        [playerId, achievementKey]\r\n      );\r\n      this.persist();\r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if player has achievement\r\n   */\r\n  hasAchievement(playerId: number, achievementKey: string): boolean {\r\n    if (!this.db) return false;\r\n\r\n    const result = this.db.exec(\r\n      `SELECT 1 FROM achievements WHERE player_id = ? AND achievement_key = ?`,\r\n      [playerId, achievementKey]\r\n    );\r\n\r\n    return result.length > 0 && result[0].values.length > 0;\r\n  }\r\n\r\n  /**\r\n   * Get player's achievements\r\n   */\r\n  getPlayerAchievements(playerId: number): AchievementRecord[] {\r\n    if (!this.db) return [];\r\n\r\n    const result = this.db.exec(`\r\n      SELECT id, player_id, achievement_key, unlocked_at\r\n      FROM achievements\r\n      WHERE player_id = ?\r\n      ORDER BY unlocked_at DESC\r\n    `, [playerId]);\r\n\r\n    if (result.length === 0) return [];\r\n\r\n    return result[0].values.map(row => ({\r\n      id: row[0] as number,\r\n      player_id: row[1] as number,\r\n      achievement_key: row[2] as string,\r\n      unlocked_at: row[3] as string,\r\n    }));\r\n  }\r\n\r\n  // ==========================================\r\n  // SETTINGS OPERATIONS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Get a setting value\r\n   */\r\n  getSetting(key: string): string | null {\r\n    if (!this.db) return null;\r\n\r\n    const result = this.db.exec(\r\n      `SELECT value FROM settings WHERE key = ?`,\r\n      [key]\r\n    );\r\n\r\n    return result[0]?.values[0]?.[0] as string ?? null;\r\n  }\r\n\r\n  /**\r\n   * Set a setting value\r\n   */\r\n  setSetting(key: string, value: string): void {\r\n    if (!this.db) return;\r\n\r\n    this.db.run(\r\n      `INSERT OR REPLACE INTO settings (key, value) VALUES (?, ?)`,\r\n      [key, value]\r\n    );\r\n    this.persist();\r\n  }\r\n\r\n  // ==========================================\r\n  // PERSISTENCE TO INDEXEDDB\r\n  // ==========================================\r\n\r\n  /**\r\n   * Open IndexedDB connection\r\n   */\r\n  private openIndexedDB(): Promise<IDBDatabase> {\r\n    return new Promise((resolve, reject) => {\r\n      const request = indexedDB.open(DB_NAME, DB_VERSION);\r\n\r\n      request.onerror = () => reject(request.error);\r\n      request.onsuccess = () => resolve(request.result);\r\n\r\n      request.onupgradeneeded = (event) => {\r\n        const db = (event.target as IDBOpenDBRequest).result;\r\n        if (!db.objectStoreNames.contains(DB_STORE)) {\r\n          db.createObjectStore(DB_STORE);\r\n        }\r\n      };\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Load database from IndexedDB\r\n   */\r\n  private async loadFromIndexedDB(): Promise<Uint8Array | null> {\r\n    try {\r\n      const db = await this.openIndexedDB();\r\n      \r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction(DB_STORE, 'readonly');\r\n        const store = transaction.objectStore(DB_STORE);\r\n        const request = store.get('database');\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => {\r\n          resolve(request.result ?? null);\r\n        };\r\n      });\r\n    } catch (error) {\r\n      console.warn('ðŸ’¾ Failed to load from IndexedDB', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Persist database to IndexedDB\r\n   */\r\n  async persist(): Promise<void> {\r\n    if (!this.db) return;\r\n\r\n    try {\r\n      const data = this.db.export();\r\n      const db = await this.openIndexedDB();\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const transaction = db.transaction(DB_STORE, 'readwrite');\r\n        const store = transaction.objectStore(DB_STORE);\r\n        const request = store.put(data, 'database');\r\n\r\n        request.onerror = () => reject(request.error);\r\n        request.onsuccess = () => resolve();\r\n      });\r\n    } catch (error) {\r\n      console.error('ðŸ’¾ Failed to persist to IndexedDB', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Export database to downloadable file\r\n   */\r\n  exportToFile(): void {\r\n    if (!this.db) return;\r\n\r\n    const data = this.db.export();\r\n    const blob = new Blob([data.buffer as ArrayBuffer], { type: 'application/x-sqlite3' });\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = `cinnamoroll-games-backup-${new Date().toISOString().split('T')[0]}.sqlite`;\r\n    a.click();\r\n\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  /**\r\n   * Import database from file\r\n   */\r\n  async importFromFile(file: File): Promise<boolean> {\r\n    if (!this.SQL) return false;\r\n\r\n    try {\r\n      const arrayBuffer = await file.arrayBuffer();\r\n      const data = new Uint8Array(arrayBuffer);\r\n\r\n      // Close existing database\r\n      if (this.db) {\r\n        this.db.close();\r\n      }\r\n\r\n      // Create new database from file\r\n      this.db = new this.SQL.Database(data);\r\n      \r\n      // Persist to IndexedDB\r\n      await this.persist();\r\n\r\n      console.log('ðŸ’¾ Database imported successfully');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('ðŸ’¾ Failed to import database', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up resources\r\n   */\r\n  destroy(): void {\r\n    if (this.db) {\r\n      this.db.close();\r\n      this.db = null;\r\n    }\r\n    this.initialized = false;\r\n    SQLiteManager.instance = null;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const sqliteManager = SQLiteManager.getInstance();\r\n","/**\r\n * AnimationManager - GSAP Animation System\r\n * \r\n * Provides smooth animations using GSAP for:\r\n * - UI transitions\r\n * - Score popups\r\n * - Screen transitions\r\n * - Character effects\r\n * \r\n * @module core/ui/AnimationManager\r\n * @version 2.0.0\r\n */\r\n\r\nimport gsap from 'gsap';\r\n\r\nexport interface AnimationOptions {\r\n  duration?: number;\r\n  ease?: string;\r\n  delay?: number;\r\n  onComplete?: () => void;\r\n}\r\n\r\n/**\r\n * Animation presets for common game animations\r\n */\r\nexport const AnimationPresets = {\r\n  // Easing presets\r\n  BOUNCE: 'bounce.out',\r\n  ELASTIC: 'elastic.out(1, 0.3)',\r\n  SMOOTH: 'power2.out',\r\n  SNAP: 'power4.out',\r\n  GENTLE: 'power1.inOut',\r\n  \r\n  // Duration presets\r\n  FAST: 0.2,\r\n  NORMAL: 0.4,\r\n  SLOW: 0.8,\r\n} as const;\r\n\r\n/**\r\n * Animation Manager using GSAP\r\n */\r\nexport class AnimationManager {\r\n  private static instance: AnimationManager | null = null;\r\n  private activeAnimations: Map<string, gsap.core.Tween> = new Map();\r\n\r\n  private constructor() {\r\n    // Configure GSAP defaults\r\n    gsap.defaults({\r\n      ease: AnimationPresets.SMOOTH,\r\n      duration: AnimationPresets.NORMAL,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): AnimationManager {\r\n    if (!AnimationManager.instance) {\r\n      AnimationManager.instance = new AnimationManager();\r\n    }\r\n    return AnimationManager.instance;\r\n  }\r\n\r\n  // ==========================================\r\n  // SCORE ANIMATIONS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Animate score popup (\"+1\" floating text)\r\n   */\r\n  scorePopup(\r\n    element: HTMLElement | object,\r\n    startX: number,\r\n    startY: number,\r\n    options: AnimationOptions = {}\r\n  ): gsap.core.Tween {\r\n    // If it's an object (for canvas), we track values\r\n    if (!(element instanceof HTMLElement)) {\r\n      return gsap.fromTo(element,\r\n        { x: startX, y: startY, opacity: 1, scale: 1 },\r\n        {\r\n          y: startY - 60,\r\n          opacity: 0,\r\n          scale: 1.5,\r\n          duration: options.duration ?? 0.8,\r\n          ease: 'power2.out',\r\n          onComplete: options.onComplete,\r\n        }\r\n      );\r\n    }\r\n\r\n    // For DOM elements\r\n    gsap.set(element, { x: startX, y: startY, opacity: 1, scale: 1 });\r\n    \r\n    return gsap.to(element, {\r\n      y: startY - 60,\r\n      opacity: 0,\r\n      scale: 1.5,\r\n      duration: options.duration ?? 0.8,\r\n      ease: 'power2.out',\r\n      onComplete: () => {\r\n        element.remove();\r\n        options.onComplete?.();\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Animate score counter change\r\n   */\r\n  scoreCounter(\r\n    element: HTMLElement,\r\n    fromValue: number,\r\n    toValue: number,\r\n    options: AnimationOptions = {}\r\n  ): gsap.core.Tween {\r\n    const obj = { value: fromValue };\r\n    \r\n    return gsap.to(obj, {\r\n      value: toValue,\r\n      duration: options.duration ?? 0.5,\r\n      ease: 'power2.out',\r\n      onUpdate: () => {\r\n        element.textContent = Math.round(obj.value).toString();\r\n      },\r\n      onComplete: options.onComplete,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Pulse animation for score milestones\r\n   */\r\n  scorePulse(element: HTMLElement | object): gsap.core.Tween {\r\n    return gsap.fromTo(element,\r\n      { scale: 1 },\r\n      {\r\n        scale: 1.3,\r\n        duration: 0.15,\r\n        ease: 'power2.out',\r\n        yoyo: true,\r\n        repeat: 1,\r\n      }\r\n    );\r\n  }\r\n\r\n  // ==========================================\r\n  // UI TRANSITIONS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Fade in an element\r\n   */\r\n  fadeIn(element: HTMLElement, options: AnimationOptions = {}): gsap.core.Tween {\r\n    return gsap.fromTo(element,\r\n      { opacity: 0 },\r\n      {\r\n        opacity: 1,\r\n        duration: options.duration ?? AnimationPresets.NORMAL,\r\n        ease: options.ease ?? AnimationPresets.SMOOTH,\r\n        delay: options.delay,\r\n        onComplete: options.onComplete,\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Fade out an element\r\n   */\r\n  fadeOut(element: HTMLElement, options: AnimationOptions = {}): gsap.core.Tween {\r\n    return gsap.to(element, {\r\n      opacity: 0,\r\n      duration: options.duration ?? AnimationPresets.NORMAL,\r\n      ease: options.ease ?? AnimationPresets.SMOOTH,\r\n      delay: options.delay,\r\n      onComplete: options.onComplete,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Slide in from direction\r\n   */\r\n  slideIn(\r\n    element: HTMLElement,\r\n    direction: 'left' | 'right' | 'top' | 'bottom' = 'bottom',\r\n    options: AnimationOptions = {}\r\n  ): gsap.core.Tween {\r\n    const offset = 50;\r\n    const fromVars: gsap.TweenVars = { opacity: 0 };\r\n\r\n    switch (direction) {\r\n      case 'left':\r\n        fromVars.x = -offset;\r\n        break;\r\n      case 'right':\r\n        fromVars.x = offset;\r\n        break;\r\n      case 'top':\r\n        fromVars.y = -offset;\r\n        break;\r\n      case 'bottom':\r\n        fromVars.y = offset;\r\n        break;\r\n    }\r\n\r\n    return gsap.fromTo(element, fromVars, {\r\n      x: 0,\r\n      y: 0,\r\n      opacity: 1,\r\n      duration: options.duration ?? AnimationPresets.NORMAL,\r\n      ease: options.ease ?? AnimationPresets.SMOOTH,\r\n      delay: options.delay,\r\n      onComplete: options.onComplete,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Bounce in animation\r\n   */\r\n  bounceIn(element: HTMLElement, options: AnimationOptions = {}): gsap.core.Tween {\r\n    return gsap.fromTo(element,\r\n      { scale: 0, opacity: 0 },\r\n      {\r\n        scale: 1,\r\n        opacity: 1,\r\n        duration: options.duration ?? 0.6,\r\n        ease: AnimationPresets.BOUNCE,\r\n        delay: options.delay,\r\n        onComplete: options.onComplete,\r\n      }\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Modal open animation\r\n   */\r\n  modalOpen(modal: HTMLElement, overlay?: HTMLElement): gsap.core.Timeline {\r\n    const tl = gsap.timeline();\r\n\r\n    if (overlay) {\r\n      tl.fromTo(overlay,\r\n        { opacity: 0 },\r\n        { opacity: 1, duration: 0.2 },\r\n        0\r\n      );\r\n    }\r\n\r\n    tl.fromTo(modal,\r\n      { scale: 0.8, opacity: 0, y: 20 },\r\n      { scale: 1, opacity: 1, y: 0, duration: 0.3, ease: AnimationPresets.BOUNCE },\r\n      0.1\r\n    );\r\n\r\n    return tl;\r\n  }\r\n\r\n  /**\r\n   * Modal close animation\r\n   */\r\n  modalClose(modal: HTMLElement, overlay?: HTMLElement): gsap.core.Timeline {\r\n    const tl = gsap.timeline();\r\n\r\n    tl.to(modal, {\r\n      scale: 0.8,\r\n      opacity: 0,\r\n      y: 20,\r\n      duration: 0.2,\r\n      ease: 'power2.in',\r\n    });\r\n\r\n    if (overlay) {\r\n      tl.to(overlay, { opacity: 0, duration: 0.2 }, 0.1);\r\n    }\r\n\r\n    return tl;\r\n  }\r\n\r\n  // ==========================================\r\n  // GAME-SPECIFIC ANIMATIONS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Player hurt/damage shake\r\n   */\r\n  shake(element: HTMLElement | object, intensity: number = 5): gsap.core.Timeline {\r\n    const tl = gsap.timeline();\r\n\r\n    tl.to(element, { x: -intensity, duration: 0.05 })\r\n      .to(element, { x: intensity, duration: 0.05 })\r\n      .to(element, { x: -intensity * 0.5, duration: 0.05 })\r\n      .to(element, { x: intensity * 0.5, duration: 0.05 })\r\n      .to(element, { x: 0, duration: 0.05 });\r\n\r\n    return tl;\r\n  }\r\n\r\n  /**\r\n   * Screen shake effect\r\n   */\r\n  screenShake(container: HTMLElement, intensity: number = 10): gsap.core.Timeline {\r\n    return this.shake(container, intensity);\r\n  }\r\n\r\n  /**\r\n   * Ghost warning pulse\r\n   */\r\n  ghostWarning(element: HTMLElement): gsap.core.Tween {\r\n    return gsap.to(element, {\r\n      opacity: 0.5,\r\n      scale: 1.1,\r\n      duration: 0.3,\r\n      ease: 'power1.inOut',\r\n      yoyo: true,\r\n      repeat: 5,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Speed up indicator animation\r\n   */\r\n  speedUpIndicator(element: HTMLElement): gsap.core.Timeline {\r\n    const tl = gsap.timeline();\r\n\r\n    tl.fromTo(element,\r\n      { scale: 0, opacity: 0 },\r\n      { scale: 1.2, opacity: 1, duration: 0.2, ease: 'back.out(1.7)' }\r\n    )\r\n    .to(element, { scale: 1, duration: 0.1 })\r\n    .to(element, { opacity: 0, y: -20, duration: 0.5, delay: 1 });\r\n\r\n    return tl;\r\n  }\r\n\r\n  /**\r\n   * Float animation (for objects)\r\n   */\r\n  float(element: HTMLElement | object, amplitude: number = 5): gsap.core.Tween {\r\n    return gsap.to(element, {\r\n      y: `+=${amplitude}`,\r\n      duration: 1.5,\r\n      ease: 'sine.inOut',\r\n      yoyo: true,\r\n      repeat: -1,\r\n    });\r\n  }\r\n\r\n  // ==========================================\r\n  // UTILITY METHODS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Kill a specific animation by ID\r\n   */\r\n  kill(id: string): void {\r\n    const tween = this.activeAnimations.get(id);\r\n    if (tween) {\r\n      tween.kill();\r\n      this.activeAnimations.delete(id);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Kill all active animations\r\n   */\r\n  killAll(): void {\r\n    this.activeAnimations.forEach(tween => tween.kill());\r\n    this.activeAnimations.clear();\r\n    gsap.killTweensOf('*');\r\n  }\r\n\r\n  /**\r\n   * Pause all animations\r\n   */\r\n  pauseAll(): void {\r\n    gsap.globalTimeline.pause();\r\n  }\r\n\r\n  /**\r\n   * Resume all animations\r\n   */\r\n  resumeAll(): void {\r\n    gsap.globalTimeline.resume();\r\n  }\r\n\r\n  /**\r\n   * Create a timeline\r\n   */\r\n  createTimeline(options?: gsap.TimelineVars): gsap.core.Timeline {\r\n    return gsap.timeline(options);\r\n  }\r\n\r\n  /**\r\n   * Get GSAP instance for advanced usage\r\n   */\r\n  get gsap() {\r\n    return gsap;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const animationManager = AnimationManager.getInstance();\r\n","/**\r\n * EffectsManager - Visual Effects with canvas-confetti\r\n * \r\n * Provides celebration and visual effects for:\r\n * - Score milestones\r\n * - High scores\r\n * - Level completion\r\n * - Achievements\r\n * \r\n * @module core/ui/EffectsManager\r\n * @version 2.0.0\r\n */\r\n\r\nimport confetti from 'canvas-confetti';\r\n\r\nexport interface ConfettiOptions {\r\n  particleCount?: number;\r\n  spread?: number;\r\n  startVelocity?: number;\r\n  decay?: number;\r\n  gravity?: number;\r\n  origin?: { x: number; y: number };\r\n  colors?: string[];\r\n  shapes?: ('square' | 'circle')[];\r\n  scalar?: number;\r\n  zIndex?: number;\r\n  disableForReducedMotion?: boolean;\r\n}\r\n\r\n/**\r\n * Preset color palettes\r\n */\r\nexport const ColorPalettes = {\r\n  SANRIO: ['#FFB6C1', '#FFD700', '#87CEEB', '#98FB98', '#DDA0DD', '#FFFFFF'] as string[],\r\n  CINNAMOROLL: ['#87CEEB', '#FFFFFF', '#FFB6C1', '#E6E6FA'] as string[],\r\n  GOLD: ['#FFD700', '#FFA500', '#FFEC8B', '#F0E68C'] as string[],\r\n  RAINBOW: ['#FF6B6B', '#FFA07A', '#FFD93D', '#6BCB77', '#4D96FF', '#9B59B6'] as string[],\r\n  CELEBRATION: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'] as string[],\r\n};\r\n\r\n/**\r\n * Effects Manager for visual celebrations\r\n */\r\nexport class EffectsManager {\r\n  private static instance: EffectsManager | null = null;\r\n  private customConfetti: confetti.CreateTypes | null = null;\r\n  private isReducedMotion: boolean = false;\r\n\r\n  private constructor() {\r\n    // Check for reduced motion preference\r\n    this.isReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;\r\n  }\r\n\r\n  /**\r\n   * Get singleton instance\r\n   */\r\n  static getInstance(): EffectsManager {\r\n    if (!EffectsManager.instance) {\r\n      EffectsManager.instance = new EffectsManager();\r\n    }\r\n    return EffectsManager.instance;\r\n  }\r\n\r\n  /**\r\n   * Initialize with a custom canvas (optional)\r\n   */\r\n  init(canvas?: HTMLCanvasElement): void {\r\n    if (canvas) {\r\n      this.customConfetti = confetti.create(canvas, { resize: true });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get confetti function (custom canvas or default)\r\n   */\r\n  private getConfetti(): confetti.CreateTypes {\r\n    // Type assertion needed as confetti module export types don't perfectly align\r\n    return (this.customConfetti ?? confetti) as confetti.CreateTypes;\r\n  }\r\n\r\n  // ==========================================\r\n  // CELEBRATION EFFECTS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Basic confetti burst\r\n   */\r\n  burst(options: ConfettiOptions = {}): void {\r\n    if (this.isReducedMotion && options.disableForReducedMotion !== false) return;\r\n\r\n    this.getConfetti()({\r\n      particleCount: options.particleCount ?? 50,\r\n      spread: options.spread ?? 60,\r\n      origin: options.origin ?? { x: 0.5, y: 0.6 },\r\n      colors: options.colors ?? ColorPalettes.SANRIO,\r\n      shapes: options.shapes ?? ['square', 'circle'],\r\n      scalar: options.scalar ?? 1,\r\n      gravity: options.gravity ?? 1,\r\n      startVelocity: options.startVelocity ?? 30,\r\n      decay: options.decay ?? 0.94,\r\n      zIndex: options.zIndex ?? 1000,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Score milestone celebration (every 10 points)\r\n   */\r\n  scoreMilestone(score: number): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    const intensity = Math.min(score / 10, 5); // Cap at 5x intensity\r\n\r\n    this.burst({\r\n      particleCount: 20 + (intensity * 10),\r\n      spread: 40 + (intensity * 10),\r\n      origin: { x: 0.5, y: 0.3 },\r\n      colors: ColorPalettes.CINNAMOROLL,\r\n      startVelocity: 25 + (intensity * 5),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * New high score celebration\r\n   */\r\n  highScore(): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    const duration = 3000;\r\n    const animationEnd = Date.now() + duration;\r\n\r\n    const frame = () => {\r\n      this.getConfetti()({\r\n        particleCount: 3,\r\n        angle: 60,\r\n        spread: 55,\r\n        origin: { x: 0 },\r\n        colors: ColorPalettes.GOLD,\r\n      });\r\n\r\n      this.getConfetti()({\r\n        particleCount: 3,\r\n        angle: 120,\r\n        spread: 55,\r\n        origin: { x: 1 },\r\n        colors: ColorPalettes.GOLD,\r\n      });\r\n\r\n      if (Date.now() < animationEnd) {\r\n        requestAnimationFrame(frame);\r\n      }\r\n    };\r\n\r\n    frame();\r\n  }\r\n\r\n  /**\r\n   * Level complete / game win celebration\r\n   */\r\n  victory(): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    const count = 200;\r\n    const defaults = {\r\n      origin: { y: 0.7 },\r\n      colors: ColorPalettes.CELEBRATION,\r\n    };\r\n\r\n    function fire(particleRatio: number, opts: confetti.Options) {\r\n      confetti({\r\n        ...defaults,\r\n        particleCount: Math.floor(count * particleRatio),\r\n        ...opts,\r\n      });\r\n    }\r\n\r\n    fire(0.25, { spread: 26, startVelocity: 55 });\r\n    fire(0.2, { spread: 60 });\r\n    fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });\r\n    fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });\r\n    fire(0.1, { spread: 120, startVelocity: 45 });\r\n  }\r\n\r\n  /**\r\n   * Achievement unlocked effect\r\n   */\r\n  achievement(): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    // Star-shaped burst\r\n    const shapes = confetti.shapeFromText({ text: 'â­', scalar: 2 });\r\n\r\n    this.getConfetti()({\r\n      particleCount: 30,\r\n      spread: 360,\r\n      origin: { x: 0.5, y: 0.5 },\r\n      shapes: [shapes],\r\n      scalar: 2,\r\n      startVelocity: 30,\r\n      gravity: 0.5,\r\n      decay: 0.9,\r\n    });\r\n\r\n    // Add regular confetti\r\n    setTimeout(() => {\r\n      this.burst({\r\n        particleCount: 60,\r\n        spread: 80,\r\n        origin: { x: 0.5, y: 0.5 },\r\n        colors: ColorPalettes.RAINBOW,\r\n      });\r\n    }, 200);\r\n  }\r\n\r\n  /**\r\n   * Side cannons effect\r\n   */\r\n  sideCannons(): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    const end = Date.now() + 1000;\r\n\r\n    const frame = () => {\r\n      this.getConfetti()({\r\n        particleCount: 2,\r\n        angle: 60,\r\n        spread: 55,\r\n        origin: { x: 0, y: 0.8 },\r\n        colors: ColorPalettes.SANRIO,\r\n      });\r\n\r\n      this.getConfetti()({\r\n        particleCount: 2,\r\n        angle: 120,\r\n        spread: 55,\r\n        origin: { x: 1, y: 0.8 },\r\n        colors: ColorPalettes.SANRIO,\r\n      });\r\n\r\n      if (Date.now() < end) {\r\n        requestAnimationFrame(frame);\r\n      }\r\n    };\r\n\r\n    frame();\r\n  }\r\n\r\n  /**\r\n   * Fireworks effect\r\n   */\r\n  fireworks(): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    const duration = 5000;\r\n    const animationEnd = Date.now() + duration;\r\n    const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };\r\n\r\n    const randomInRange = (min: number, max: number) => Math.random() * (max - min) + min;\r\n\r\n    const interval = setInterval(() => {\r\n      const timeLeft = animationEnd - Date.now();\r\n\r\n      if (timeLeft <= 0) {\r\n        clearInterval(interval);\r\n        return;\r\n      }\r\n\r\n      const particleCount = 50 * (timeLeft / duration);\r\n\r\n      this.getConfetti()({\r\n        ...defaults,\r\n        particleCount,\r\n        origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 },\r\n        colors: ColorPalettes.CELEBRATION,\r\n      });\r\n\r\n      this.getConfetti()({\r\n        ...defaults,\r\n        particleCount,\r\n        origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 },\r\n        colors: ColorPalettes.CELEBRATION,\r\n      });\r\n    }, 250);\r\n  }\r\n\r\n  /**\r\n   * Snow/stars falling effect\r\n   */\r\n  snow(duration: number = 5000): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    const animationEnd = Date.now() + duration;\r\n    let skew = 1;\r\n\r\n    const frame = () => {\r\n      const timeLeft = animationEnd - Date.now();\r\n      const ticks = Math.max(200, 500 * (timeLeft / duration));\r\n\r\n      skew = Math.max(0.8, skew - 0.001);\r\n\r\n      this.getConfetti()({\r\n        particleCount: 1,\r\n        startVelocity: 0,\r\n        ticks,\r\n        gravity: 0.5,\r\n        origin: {\r\n          x: Math.random(),\r\n          y: Math.random() * skew - 0.2,\r\n        },\r\n        colors: ['#FFFFFF', '#E6E6FA', '#87CEEB'],\r\n        shapes: ['circle'],\r\n        scalar: Math.random() * 0.5 + 0.5,\r\n        drift: Math.random() - 0.5,\r\n      });\r\n\r\n      if (timeLeft > 0) {\r\n        requestAnimationFrame(frame);\r\n      }\r\n    };\r\n\r\n    frame();\r\n  }\r\n\r\n  /**\r\n   * Hearts effect (for Sanrio theme)\r\n   */\r\n  hearts(): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    const heart = confetti.shapeFromText({ text: 'ðŸ’–', scalar: 2 });\r\n\r\n    this.getConfetti()({\r\n      particleCount: 20,\r\n      spread: 100,\r\n      origin: { x: 0.5, y: 0.5 },\r\n      shapes: [heart],\r\n      scalar: 2,\r\n      gravity: 0.8,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Quick sparkle at a specific position\r\n   */\r\n  sparkle(x: number, y: number): void {\r\n    if (this.isReducedMotion) return;\r\n\r\n    this.getConfetti()({\r\n      particleCount: 10,\r\n      spread: 30,\r\n      origin: { x, y },\r\n      colors: ['#FFD700', '#FFFFFF', '#FFB6C1'],\r\n      shapes: ['circle'],\r\n      scalar: 0.5,\r\n      startVelocity: 15,\r\n      gravity: 0.5,\r\n      decay: 0.9,\r\n    });\r\n  }\r\n\r\n  // ==========================================\r\n  // UTILITY METHODS\r\n  // ==========================================\r\n\r\n  /**\r\n   * Reset/clear all confetti\r\n   */\r\n  reset(): void {\r\n    if (this.customConfetti) {\r\n      this.customConfetti.reset();\r\n    } else {\r\n      confetti.reset();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if reduced motion is enabled\r\n   */\r\n  get reducedMotion(): boolean {\r\n    return this.isReducedMotion;\r\n  }\r\n\r\n  /**\r\n   * Enable/disable reduced motion\r\n   */\r\n  setReducedMotion(enabled: boolean): void {\r\n    this.isReducedMotion = enabled;\r\n  }\r\n\r\n  /**\r\n   * Clean up\r\n   */\r\n  destroy(): void {\r\n    this.reset();\r\n    this.customConfetti = null;\r\n    EffectsManager.instance = null;\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const effectsManager = EffectsManager.getInstance();\r\n","/**\r\n * PauseOverlay - Pause Menu UI Component\r\n * \r\n * Provides a pause menu with:\r\n * - Resume, Restart, Quit options\r\n * - GSAP animations\r\n * - Keyboard navigation\r\n * \r\n * @module core/ui/PauseOverlay\r\n * @version 2.0.0\r\n */\r\n\r\nimport { animationManager } from './AnimationManager';\r\nimport { EventSystem, GameEvents } from '../engine/EventSystem';\r\n\r\nexport interface PauseOverlayOptions {\r\n  container: HTMLElement;\r\n  onResume?: () => void;\r\n  onRestart?: () => void;\r\n  onQuit?: () => void;\r\n  showQuit?: boolean;\r\n}\r\n\r\n/**\r\n * Pause overlay component\r\n */\r\nexport class PauseOverlay {\r\n  private container: HTMLElement;\r\n  private overlay: HTMLElement | null = null;\r\n  private modal: HTMLElement | null = null;\r\n  private isVisible: boolean = false;\r\n  private options: PauseOverlayOptions;\r\n  private keyHandler: ((e: KeyboardEvent) => void) | null = null;\r\n\r\n  constructor(options: PauseOverlayOptions) {\r\n    this.options = options;\r\n    this.container = options.container;\r\n    this.createOverlay();\r\n    this.setupKeyboardHandler();\r\n  }\r\n\r\n  /**\r\n   * Create the overlay DOM structure\r\n   */\r\n  private createOverlay(): void {\r\n    // Create overlay backdrop\r\n    this.overlay = document.createElement('div');\r\n    this.overlay.className = 'pause-overlay';\r\n    this.overlay.style.cssText = `\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      background: rgba(0, 0, 0, 0.7);\r\n      backdrop-filter: blur(5px);\r\n      display: none;\r\n      justify-content: center;\r\n      align-items: center;\r\n      z-index: 1000;\r\n    `;\r\n\r\n    // Create modal\r\n    this.modal = document.createElement('div');\r\n    this.modal.className = 'pause-modal';\r\n    this.modal.style.cssText = `\r\n      background: linear-gradient(135deg, #FFFFFF 0%, #F5F5F5 100%);\r\n      border-radius: 20px;\r\n      padding: 30px 40px;\r\n      text-align: center;\r\n      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);\r\n      min-width: 280px;\r\n    `;\r\n\r\n    // Modal content\r\n    this.modal.innerHTML = `\r\n      <div class=\"pause-title\" style=\"\r\n        font-size: 28px;\r\n        font-weight: bold;\r\n        color: #5BA3D0;\r\n        margin-bottom: 10px;\r\n      \">â¸ï¸ Paused</div>\r\n      <div class=\"pause-subtitle\" style=\"\r\n        font-size: 14px;\r\n        color: #888;\r\n        margin-bottom: 25px;\r\n      \">Press Escape to resume</div>\r\n      <div class=\"pause-buttons\" style=\"\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 12px;\r\n      \">\r\n        <button class=\"pause-btn resume-btn\" style=\"\r\n          padding: 14px 40px;\r\n          font-size: 18px;\r\n          font-weight: bold;\r\n          background: linear-gradient(135deg, #87CEEB, #5BA3D0);\r\n          color: white;\r\n          border: none;\r\n          border-radius: 10px;\r\n          cursor: pointer;\r\n          transition: transform 0.2s, box-shadow 0.2s;\r\n        \">â–¶ï¸ Resume</button>\r\n        <button class=\"pause-btn restart-btn\" style=\"\r\n          padding: 14px 40px;\r\n          font-size: 18px;\r\n          font-weight: bold;\r\n          background: linear-gradient(135deg, #FFB6C1, #FF69B4);\r\n          color: white;\r\n          border: none;\r\n          border-radius: 10px;\r\n          cursor: pointer;\r\n          transition: transform 0.2s, box-shadow 0.2s;\r\n        \">ðŸ”„ Restart</button>\r\n        ${this.options.showQuit !== false ? `\r\n          <button class=\"pause-btn quit-btn\" style=\"\r\n            padding: 14px 40px;\r\n            font-size: 18px;\r\n            font-weight: bold;\r\n            background: linear-gradient(135deg, #E0E0E0, #BDBDBD);\r\n            color: #555;\r\n            border: none;\r\n            border-radius: 10px;\r\n            cursor: pointer;\r\n            transition: transform 0.2s, box-shadow 0.2s;\r\n          \">ðŸšª Quit</button>\r\n        ` : ''}\r\n      </div>\r\n    `;\r\n\r\n    // Add event listeners to buttons\r\n    const resumeBtn = this.modal.querySelector('.resume-btn');\r\n    const restartBtn = this.modal.querySelector('.restart-btn');\r\n    const quitBtn = this.modal.querySelector('.quit-btn');\r\n\r\n    resumeBtn?.addEventListener('click', () => this.handleResume());\r\n    restartBtn?.addEventListener('click', () => this.handleRestart());\r\n    quitBtn?.addEventListener('click', () => this.handleQuit());\r\n\r\n    // Add hover effects\r\n    this.modal.querySelectorAll('.pause-btn').forEach(btn => {\r\n      btn.addEventListener('mouseenter', () => {\r\n        (btn as HTMLElement).style.transform = 'scale(1.05)';\r\n        (btn as HTMLElement).style.boxShadow = '0 5px 20px rgba(0, 0, 0, 0.2)';\r\n      });\r\n      btn.addEventListener('mouseleave', () => {\r\n        (btn as HTMLElement).style.transform = 'scale(1)';\r\n        (btn as HTMLElement).style.boxShadow = 'none';\r\n      });\r\n    });\r\n\r\n    // Append to DOM\r\n    this.overlay.appendChild(this.modal);\r\n    this.container.appendChild(this.overlay);\r\n  }\r\n\r\n  /**\r\n   * Setup keyboard handler for pause menu\r\n   */\r\n  private setupKeyboardHandler(): void {\r\n    this.keyHandler = (e: KeyboardEvent) => {\r\n      if (!this.isVisible) return;\r\n\r\n      switch (e.key) {\r\n        case 'Escape':\r\n          e.preventDefault();\r\n          this.handleResume();\r\n          break;\r\n        case 'Enter':\r\n          e.preventDefault();\r\n          this.handleResume();\r\n          break;\r\n        case 'r':\r\n        case 'R':\r\n          e.preventDefault();\r\n          this.handleRestart();\r\n          break;\r\n        case 'q':\r\n        case 'Q':\r\n          if (this.options.showQuit !== false) {\r\n            e.preventDefault();\r\n            this.handleQuit();\r\n          }\r\n          break;\r\n      }\r\n    };\r\n\r\n    document.addEventListener('keydown', this.keyHandler);\r\n  }\r\n\r\n  /**\r\n   * Show the pause overlay\r\n   */\r\n  show(): void {\r\n    if (this.isVisible || !this.overlay || !this.modal) return;\r\n\r\n    this.isVisible = true;\r\n    this.overlay.style.display = 'flex';\r\n\r\n    // Animate in\r\n    animationManager.modalOpen(this.modal, this.overlay);\r\n\r\n    EventSystem.emit(GameEvents.MODAL_OPEN, { type: 'pause' });\r\n  }\r\n\r\n  /**\r\n   * Hide the pause overlay\r\n   */\r\n  hide(): void {\r\n    if (!this.isVisible || !this.overlay || !this.modal) return;\r\n\r\n    // Animate out\r\n    const tl = animationManager.modalClose(this.modal, this.overlay);\r\n    \r\n    tl.then(() => {\r\n      if (this.overlay) {\r\n        this.overlay.style.display = 'none';\r\n      }\r\n      this.isVisible = false;\r\n      EventSystem.emit(GameEvents.MODAL_CLOSE, { type: 'pause' });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Toggle visibility\r\n   */\r\n  toggle(): boolean {\r\n    if (this.isVisible) {\r\n      this.hide();\r\n    } else {\r\n      this.show();\r\n    }\r\n    return this.isVisible;\r\n  }\r\n\r\n  /**\r\n   * Handle resume action\r\n   */\r\n  private handleResume(): void {\r\n    this.hide();\r\n    this.options.onResume?.();\r\n    EventSystem.emit(GameEvents.GAME_RESUME, { source: 'pause-menu' });\r\n  }\r\n\r\n  /**\r\n   * Handle restart action\r\n   */\r\n  private handleRestart(): void {\r\n    this.hide();\r\n    this.options.onRestart?.();\r\n    EventSystem.emit(GameEvents.GAME_RESTART, { source: 'pause-menu' });\r\n  }\r\n\r\n  /**\r\n   * Handle quit action\r\n   */\r\n  private handleQuit(): void {\r\n    this.hide();\r\n    this.options.onQuit?.();\r\n  }\r\n\r\n  /**\r\n   * Check if overlay is visible\r\n   */\r\n  get visible(): boolean {\r\n    return this.isVisible;\r\n  }\r\n\r\n  /**\r\n   * Clean up resources\r\n   */\r\n  destroy(): void {\r\n    if (this.keyHandler) {\r\n      document.removeEventListener('keydown', this.keyHandler);\r\n    }\r\n\r\n    if (this.overlay && this.overlay.parentNode) {\r\n      this.overlay.parentNode.removeChild(this.overlay);\r\n    }\r\n\r\n    this.overlay = null;\r\n    this.modal = null;\r\n  }\r\n}\r\n\r\n// Export factory function\r\nexport function createPauseOverlay(options: PauseOverlayOptions): PauseOverlay {\r\n  return new PauseOverlay(options);\r\n}\r\n","/**\r\n * Game Integration Bridge\r\n * \r\n * This module bridges the new TypeScript infrastructure with the existing\r\n * vanilla JavaScript game code. It provides a simple API that the existing\r\n * index.html can use without major refactoring.\r\n * \r\n * @module GameBridge\r\n * @version 2.0.0\r\n */\r\n\r\nimport { EventSystem, GameEvents } from './core/engine/EventSystem';\r\nimport { GameLoop, createGameLoop, type FrameInfo } from './core/engine/GameLoop';\r\nimport { visibilityManager } from './core/engine/VisibilityManager';\r\nimport { PhysicsSystem, createPhysicsSystem, type PhysicsBody } from './core/physics/PhysicsSystem';\r\nimport { audioManager, SoundType } from './core/audio/AudioManager';\r\nimport { sqliteManager } from './core/storage/SQLiteManager';\r\nimport { animationManager } from './core/ui/AnimationManager';\r\nimport { effectsManager } from './core/ui/EffectsManager';\r\nimport { PauseOverlay, createPauseOverlay } from './core/ui/PauseOverlay';\r\n\r\n/**\r\n * Legacy-compatible game bridge\r\n * Exposes new functionality through a simple global API\r\n */\r\nexport class GameBridge {\r\n  private gameLoop: GameLoop | null = null;\r\n  private physics: PhysicsSystem | null = null;\r\n  private pauseOverlay: PauseOverlay | null = null;\r\n  private isInitialized = false;\r\n\r\n  /**\r\n   * Initialize all game systems\r\n   */\r\n  async initialize(): Promise<void> {\r\n    if (this.isInitialized) return;\r\n\r\n    console.log('[GameBridge] Initializing game systems...');\r\n\r\n    // Initialize SQLite database\r\n    try {\r\n      await sqliteManager.init();\r\n      console.log('[GameBridge] SQLite initialized');\r\n    } catch (error) {\r\n      console.warn('[GameBridge] SQLite initialization failed, using fallback:', error);\r\n    }\r\n\r\n    // Initialize audio manager\r\n    await audioManager.init();\r\n    console.log('[GameBridge] Audio manager initialized');\r\n\r\n    // Create game loop with proper delta time handling\r\n    this.gameLoop = createGameLoop({\r\n      maxDeltaTime: 100,\r\n      fixedTimestep: 16.67, // 60fps target\r\n    });\r\n\r\n    // Create physics system\r\n    this.physics = createPhysicsSystem({\r\n      gravity: 0.5,\r\n      maxVelocityY: 12,\r\n    });\r\n\r\n    // Initialize visibility manager (auto-pause on tab switch)\r\n    visibilityManager.init();\r\n\r\n    this.isInitialized = true;\r\n    console.log('[GameBridge] All systems initialized');\r\n  }\r\n\r\n  /**\r\n   * Create pause overlay for a game\r\n   */\r\n  createPauseMenu(container: HTMLElement, callbacks: {\r\n    onResume?: () => void;\r\n    onRestart?: () => void;\r\n    onQuit?: () => void;\r\n  }): PauseOverlay {\r\n    this.pauseOverlay = createPauseOverlay({\r\n      container,\r\n      onResume: callbacks.onResume,\r\n      onRestart: callbacks.onRestart,\r\n      onQuit: callbacks.onQuit,\r\n    });\r\n    return this.pauseOverlay;\r\n  }\r\n\r\n  /**\r\n   * Start the game loop with legacy update/render functions\r\n   */\r\n  startGameLoop(\r\n    updateFn: (deltaTime: number, frameInfo: FrameInfo) => void,\r\n    renderFn: (deltaTime: number, frameInfo: FrameInfo) => void\r\n  ): void {\r\n    if (!this.gameLoop) {\r\n      console.error('[GameBridge] Game loop not initialized');\r\n      return;\r\n    }\r\n\r\n    this.gameLoop.onUpdate((frameInfo) => {\r\n      updateFn(frameInfo.deltaTime, frameInfo);\r\n    });\r\n\r\n    this.gameLoop.onRender((frameInfo) => {\r\n      renderFn(frameInfo.deltaTime, frameInfo);\r\n    });\r\n\r\n    this.gameLoop.start();\r\n  }\r\n\r\n  /**\r\n   * Stop the game loop\r\n   */\r\n  stopGameLoop(): void {\r\n    this.gameLoop?.stop();\r\n  }\r\n\r\n  /**\r\n   * Pause/resume game\r\n   */\r\n  pauseGame(): void {\r\n    this.gameLoop?.pause();\r\n    this.pauseOverlay?.show();\r\n  }\r\n\r\n  resumeGame(): void {\r\n    this.pauseOverlay?.hide();\r\n    this.gameLoop?.resume();\r\n  }\r\n\r\n  togglePause(): boolean {\r\n    const isPaused = this.gameLoop?.togglePause() ?? false;\r\n    if (isPaused) {\r\n      this.pauseOverlay?.show();\r\n    } else {\r\n      this.pauseOverlay?.hide();\r\n    }\r\n    return isPaused;\r\n  }\r\n\r\n  /**\r\n   * Physics helpers - use these instead of raw calculations\r\n   */\r\n  applyGravity(body: PhysicsBody, deltaTime: number): void {\r\n    this.physics?.applyGravity(body, deltaTime);\r\n  }\r\n\r\n  applyVelocity(body: PhysicsBody, deltaTime: number): void {\r\n    this.physics?.applyVelocity(body, deltaTime);\r\n  }\r\n\r\n  applyImpulse(body: PhysicsBody, impulseX: number, impulseY: number): void {\r\n    this.physics?.applyImpulse(body, impulseX, impulseY);\r\n  }\r\n\r\n  checkCloudCollision(\r\n    player: PhysicsBody,\r\n    cloudX: number,\r\n    cloudWidth: number,\r\n    gapY: number,\r\n    gapHeight: number,\r\n    canvasHeight: number\r\n  ): boolean {\r\n    return PhysicsSystem.checkCloudGapCollision(\r\n      player,\r\n      cloudX,\r\n      cloudWidth,\r\n      gapY,\r\n      gapHeight,\r\n      canvasHeight,\r\n      0.7 // 70% forgiveness factor\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Audio helpers\r\n   */\r\n  playSound(type: keyof typeof SoundType): void {\r\n    audioManager.play(type);\r\n  }\r\n\r\n  setMasterVolume(volume: number): void {\r\n    audioManager.setMasterVolume(volume);\r\n  }\r\n\r\n  /**\r\n   * Visual effects\r\n   */\r\n  scorePopup(element: HTMLElement, x: number, y: number): void {\r\n    animationManager.scorePopup(element, x, y);\r\n  }\r\n\r\n  celebrateScore(milestone: number): void {\r\n    if (milestone >= 100) {\r\n      effectsManager.fireworks();\r\n    } else if (milestone >= 50) {\r\n      effectsManager.victory();\r\n    } else if (milestone >= 10) {\r\n      effectsManager.scoreMilestone(milestone);\r\n    }\r\n  }\r\n\r\n  celebrateHighScore(): void {\r\n    effectsManager.highScore();\r\n  }\r\n\r\n  celebrateAchievement(): void {\r\n    effectsManager.achievement();\r\n  }\r\n\r\n  /**\r\n   * Database operations\r\n   */\r\n  async saveScore(playerId: number, gameId: string, score: number): Promise<void> {\r\n    sqliteManager.addScore(playerId, gameId, score);\r\n  }\r\n\r\n  async getHighScores(gameId: string, limit = 10): Promise<any[]> {\r\n    return sqliteManager.getHighScores(gameId, limit);\r\n  }\r\n\r\n  async getPlayerBestScore(playerId: number, gameId: string): Promise<number> {\r\n    return sqliteManager.getPlayerBestScore(playerId, gameId);\r\n  }\r\n\r\n  /**\r\n   * Event system - for custom game events\r\n   */\r\n  on(event: string, callback: (data?: any) => void): () => void {\r\n    return EventSystem.on(event, callback);\r\n  }\r\n\r\n  emit(event: string, data?: any): void {\r\n    EventSystem.emit(event, data);\r\n  }\r\n\r\n  /**\r\n   * Pre-defined game events\r\n   */\r\n  emitGameStart(): void {\r\n    EventSystem.emit(GameEvents.GAME_START);\r\n  }\r\n\r\n  emitGameOver(score: number): void {\r\n    EventSystem.emit(GameEvents.GAME_OVER, { score });\r\n  }\r\n\r\n  emitScoreChange(score: number, highScore: number): void {\r\n    EventSystem.emit(GameEvents.SCORE_UPDATE, { score, highScore });\r\n  }\r\n\r\n  /**\r\n   * Cleanup\r\n   */\r\n  destroy(): void {\r\n    this.gameLoop?.destroy();\r\n    this.pauseOverlay?.destroy();\r\n    EventSystem.removeAllListeners();\r\n    this.isInitialized = false;\r\n  }\r\n}\r\n\r\n// Create singleton instance\r\nexport const gameBridge = new GameBridge();\r\n\r\n// Expose to window for legacy scripts\r\ndeclare global {\r\n  interface Window {\r\n    GameBridge: typeof gameBridge;\r\n  }\r\n}\r\n\r\nif (typeof window !== 'undefined') {\r\n  window.GameBridge = gameBridge;\r\n}\r\n","/**\r\n * Flappy Cinnamoroll - Game Integration Module\r\n * \r\n * This module provides the integration layer between the new TypeScript\r\n * infrastructure and the legacy vanilla JavaScript game in index.html.\r\n * \r\n * Usage in index.html:\r\n *   <script type=\"module\" src=\"/src/flappy-integration.ts\"></script>\r\n * \r\n * @module flappy-integration\r\n * @version 2.0.0\r\n */\r\n\r\nimport { gameBridge } from './GameBridge';\r\nimport { EventSystem, GameEvents } from './core/engine/EventSystem';\r\nimport { effectsManager } from './core/ui/EffectsManager';\r\nimport { animationManager } from './core/ui/AnimationManager';\r\n\r\n// Export for global access\r\nexport { gameBridge, EventSystem, GameEvents, effectsManager, animationManager };\r\n\r\n/**\r\n * Initialize game systems when DOM is ready\r\n */\r\nasync function initializeFlappyGame(): Promise<void> {\r\n  console.log('ðŸŽ® Initializing Flappy Cinnamoroll v2.0...');\r\n\r\n  try {\r\n    // Initialize the game bridge (audio, visibility, etc.)\r\n    await gameBridge.initialize();\r\n\r\n    // Make the bridge available globally for legacy code\r\n    (window as any).FlappyBridge = {\r\n      // Celebrate score milestones\r\n      celebrateScore: (score: number) => {\r\n        gameBridge.celebrateScore(score);\r\n      },\r\n\r\n      // Play high score celebration\r\n      celebrateHighScore: () => {\r\n        gameBridge.celebrateHighScore();\r\n      },\r\n\r\n      // Pause game\r\n      pause: () => {\r\n        gameBridge.pauseGame();\r\n      },\r\n\r\n      // Resume game\r\n      resume: () => {\r\n        gameBridge.resumeGame();\r\n      },\r\n\r\n      // Toggle pause\r\n      togglePause: () => {\r\n        return gameBridge.togglePause();\r\n      },\r\n\r\n      // Play sound effect\r\n      playSound: (type: string) => {\r\n        gameBridge.playSound(type as any);\r\n      },\r\n\r\n      // Emit game events\r\n      emitGameStart: () => gameBridge.emitGameStart(),\r\n      emitGameOver: (score: number) => gameBridge.emitGameOver(score),\r\n      emitScoreChange: (score: number, highScore: number) => \r\n        gameBridge.emitScoreChange(score, highScore),\r\n\r\n      // Subscribe to events\r\n      on: (event: string, callback: (data?: any) => void) => {\r\n        return gameBridge.on(event, callback);\r\n      },\r\n\r\n      // Event constants\r\n      Events: GameEvents,\r\n    };\r\n\r\n    console.log('âœ… FlappyBridge ready - access via window.FlappyBridge');\r\n\r\n  } catch (error) {\r\n    console.error('âŒ Failed to initialize Flappy game systems:', error);\r\n  }\r\n}\r\n\r\n// Auto-initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', initializeFlappyGame);\r\n} else {\r\n  initializeFlappyGame();\r\n}\r\n"],"names":["GameEvents","EventSystemClass","event","callback","entry","entries","index","e","data","entriesCopy","error","enabled","ScopedEventEmitter","parent","unsub","EventSystem","VisibilityManager","wasVisible","now","hiddenDuration","visibilityManager","GameLoop","config","timestamp","deltaTime","frameInfo","fixedFrameInfo","instantFps","avgFps","b","createGameLoop","DEFAULT_PHYSICS_CONFIG","BASE_TIMESTEP","PhysicsSystem","body","timeFactor","impulseX","impulseY","velocityX","velocityY","a","dx","dy","circle","rect","closestX","closestY","distanceX","distanceY","radius","player","obstacle","forgivenessPercent","cloudX","cloudWidth","gapY","gapHeight","canvasHeight","playerCircle","topCloud","bottomCloud","bounds","result","start","end","t","createPhysicsSystem","SoundType","AudioManager","Howler","resumeContext","id","definition","resolve","reject","sound","Howl","_soundId","sprite","type","ctx","osc","gain","freq","i","notes","durations","time","volume","audioManager","DB_NAME","DB_STORE","DB_VERSION","SQLiteManager","initSqlJs","file","savedData","name","trimmedName","existing","row","created","playerId","game","score","level","newId","limit","achievementKey","key","value","request","db","blob","url","arrayBuffer","sqliteManager","AnimationPresets","AnimationManager","gsap","element","startX","startY","options","fromValue","toValue","obj","direction","fromVars","modal","overlay","tl","intensity","container","amplitude","tween","animationManager","ColorPalettes","EffectsManager","canvas","confetti","animationEnd","frame","count","defaults","fire","particleRatio","opts","shapes","duration","randomInRange","min","max","interval","timeLeft","particleCount","skew","ticks","heart","x","y","effectsManager","PauseOverlay","resumeBtn","restartBtn","quitBtn","btn","createPauseOverlay","GameBridge","callbacks","updateFn","renderFn","isPaused","milestone","gameId","highScore","gameBridge","initializeFlappyGame"],"mappings":"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"}